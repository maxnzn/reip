#!/usr/bin/env python
import contextlib as __stickytape_contextlib
@__stickytape_contextlib.contextmanager
def __stickytape_temporary_dir():
	import tempfile as B,shutil as C;A=B.mkdtemp()
	try:yield A
	finally:C.rmtree(A)
with __stickytape_temporary_dir()as __stickytape_working_dir:
	def __stickytape_write_module(path,contents):
		import os,os.path
		def A(path):
			B=path.split('/');A=__stickytape_working_dir
			for C in B:
				A=os.path.join(A,C)
				if not os.path.exists(A):
					os.mkdir(A)
					with open(os.path.join(A,'__init__.py'),'wb')as D:D.write(b'\n')
		A(os.path.dirname(path));B=os.path.join(__stickytape_working_dir,path)
		with open(B,'wb')as C:C.write(contents)
	import sys as __stickytape_sys;__stickytape_sys.path.insert(0,__stickytape_working_dir);__stickytape_write_module('model/simulation.py',b'from helpers.status import systemiserStatusMessage\nfrom helpers.general import extendDict\nfrom model.set_initial_state import set_initial_state\nfrom model.sim_base_demand import simBaseDemands\nfrom model.sim_phase_1 import simPhase1\nfrom model.sim_phase_2 import simPhase2\nfrom model.sim_phase_3 import simPhase3\nfrom model.sim_phase_4 import simPhase4\nfrom model.sim_phase_5 import simPhase5\nfrom model.sim_phase_6 import simPhase6\nfrom model.track_metrics import trackMetrics\nfrom model.update_emissions_levels import updateEmissionLevels\nfrom model.update_firming_control import updateFirmingControl\nfrom model.update_store_levels import updateStoreLevels\nfrom results.results import annual_results, cost_and_revenue, create_results_object\n\n\ndef run_model(s, settings):\n\n    d = {}\n    simBaseDemands(s, settings, d)\n    set_initial_state(s, settings, d)\n\n\n    for i in range(settings["simLength"]):\n        systemiserStatusMessage(str(i))\n        simPhase1(i, s, settings)\n        simPhase2(i, s, settings)\n#        simPhase3(i, s, settings) # I think it\'s possible to get away with this, because the number of layers in the networ has been reduced\n#        simPhase4(i, s, settings)\n#        simPhase5(i, s, settings)\n        simPhase6(i, s, settings)\n        updateStoreLevels(i, s, settings)\n        updateEmissionLevels(i, s, settings)\n        updateFirmingControl(i, s)\n        trackMetrics(i, s)\n    return s\n\n\ndef build_results(s, settings, units):\n    results, resultsKeys = create_results_object(s, settings)\n    annualResults, checks = annual_results(settings, results, resultsKeys, units)\n    capex, finex, opex, resourcex, carbonex, annualCost, annualRevenue, metrics = cost_and_revenue(annualResults, settings, s)\n\n    metrics = extendDict(metrics,15)\n    annualResults = extendDict(annualResults, 110)\n\n    answer = {\n        \'s\': s,\n        \'results\': results,\n        \'checks\': checks,\n        \'annualResults\': annualResults,\n        \'metrics\': metrics,\n        \'capex\': capex,\n        \'finex\': finex,\n        \'opex\': opex,\n        \'resourcex\': resourcex,\n        \'carbonex\': carbonex,\n        \'annualCost\': annualCost,\n        \'annualRevenue\': annualRevenue,\n        \'units\': units\n        }\n    return answer\n\n\n\ndef simulation(s, settings, units):\n    s = run_model(s, settings)\n    answer = build_results(s, settings, units)\n    return answer\n\n');__stickytape_write_module('helpers/status.py',b'def systemiserStatusMessage(message: str):\n    statusAvailable = "__sysUpdateStatus" in globals()\n    if statusAvailable:\n        globals()["__sysUpdateStatus"](message)\n');__stickytape_write_module('helpers/general.py',b'import sys\n\ndef toFloat(text: str):\n    if isinstance(text, (float, int)):\n        return text\n    return float(text.replace(",", "."))\n\ndef roundTo(number, decimalPoints):\n    factor = pow(10, decimalPoints)\n    return round(number * factor) / factor\n\ndef isSystemiser():\n    return "pyodide" in sys.modules\n\ndef single_yes_or_no_question(question, default_no=True):\n    choices = " [y/N]: " if default_no else " [Y/n]: "\n    default_answer = "n" if default_no else "y"\n    reply = str(input(question + choices)).lower().strip() or default_answer\n    if reply[0] == "y":\n        return True\n    if reply[0] == "n":\n        return False\n    else:\n        return not default_no\n\ndef extendDict(dict,newLength):\n    current_length = len(dict)\n    for i in range(current_length + 1, newLength):\n        dict[f\'zz{i - current_length}\'] = 0\n    return dict\n    \ndef reorder_dict_alphabetically(d):\n    return {k: d[k] for k in sorted(d)}');__stickytape_write_module('model/set_initial_state.py',b'def flag_hours_in_range(start_hour, finish_hour, total_hours=8760):\n    start_hour = int(start_hour)\n    finish_hour = int(finish_hour)\n    total_hours = int(total_hours)\n    flagged_hours = [0] * total_hours\n    hours_in_day = 24\n\n    for day in range(total_hours // hours_in_day):\n        for hour in range(start_hour, finish_hour):\n            flagged_hours[day * hours_in_day + hour] = 1\n\n    return flagged_hours\n\n\n\ndef set_initial_state(s, settings, d):\n    \n\n    s["firmingAllowedDict"][0] = 1\n    initialStoreLevelsNames = [\n        "electricity",\n    #    "water",\n        "h2",\n    #    "mp1StoreLevel",\n    #    "nh3StoreLevel",\n    #    "lohcStoreLevel",\n    #    "iron",\n    #    "fertStoreLevel",\n    ]\n    for n in initialStoreLevelsNames:\n        label0 = n + "StorePercentHour0"\n        labelCapacity = n + "StoreCapacity"\n        label = n + "StoreLevel"\n        s[label + "Dict"][0] = settings[label0] * settings[labelCapacity]\n        s[label] = settings[label0] * settings[labelCapacity]  # store levels are both settings and state...\n\n    s["waterStoreLevelDict"][0] = settings["waterStorePercentHour0"] * s["waterStoreCapacity"]\n    s["waterStoreLevel"] = settings["waterStorePercentHour0"] * s["waterStoreCapacity"]\n\n    s["benchmarkEnergyInput"] = d["electricityBaseDemand"]/d["ironBaseDemand"]\n    s["ironPriceAfterCarbon"] = (settings["ironMarketValue"]*1000 \n                                 + settings["ironMarketEmissionsIntensity"]*settings["carbonPrice"])\n    s["ironValueAdd"] = s["ironPriceAfterCarbon"] - settings["ironOreUnitCost"]\n    s["electricityGridBreakevenPrice"] = s["ironValueAdd"]/s["benchmarkEnergyInput"]\n\n    """(by hour): kWh required * (0.0147+0.0009)\n    (day): 128.7 + kVA_peak * 0.243 [5-9pm] + kVA anytime * 0.0719 [!5-9pm]\n\n  \n    NEW:\n    (by hour): kWh required * (0.0064 [energy based usage] + 0.024 [env policy]) +\n    (day): 216.46 [flat] + kVA_peak * 0.277825 [>38\xc2\xb0C] + kVA anytime * 0.0812 [anytime]\n     """\n                                            \n    s["networkHourlyStandingCharge"] = settings["electricityGridNetworkDailyCharge"]/24\n    kvaGridCapacity = 1000 * settings["electricityGridCapacity"] / settings["electricityGridPowerFactor"]\n    kvaPeakHourlyCharge = kvaGridCapacity * settings["electricityGridKvaPeakDailyCharge"]/24\n    kvaOffPeakHourlyCharge = kvaGridCapacity * settings["electricityGridKvaOffPeakDailyCharge"]/24\n\n    flaggedHours = flag_hours_in_range(round(settings["electricityGridPeakStart"]), round(settings["electricityGridPeakFinish"]), settings["simLength"])\n\n    for i in range(settings["simLength"]):\n        if flaggedHours[i] == 1:\n            s["electricityGridKvaCharge"][i] = kvaPeakHourlyCharge\n        if flaggedHours[i] == 0:\n            s["electricityGridKvaCharge"][i] = kvaOffPeakHourlyCharge\n\n\n');__stickytape_write_module('model/sim_base_demand.py',b'\nfrom re import S\nfrom model.functions import (\n    calcDistributeDemand,\n    calcProduceDemand,\n    calcProduceInputDemand,\n    calcStoreDemand,\n)\n\n# def electricityPriceCheck\n\ndef simBaseDemands(s, settings,d):\n\n\n    s["ironPostPProduceCapacity"] = settings["ironProduceCapacity"]\n    s["ironRawProduceCapacity"] = s["ironPostPProduceCapacity"] * settings["ironRawToIronPostP"]\n    s["ironPrePProduceCapacity"] = s["ironRawProduceCapacity"] * settings["ironPrePToIronRaw"]\n    s["ironDistributeCapacity"] = settings["ironProduceCapacity"]\n\n\n    d["ironDistributeDemand"] = s["ironDistributeCapacity"]\n\n    d["ironBaseDemand"] = d["ironDistributeDemand"]\n\n    d["ironProduceDemand"] = calcProduceDemand(settings["ironProduceCapacity"],d["ironDistributeDemand"], 0)\n\n    d["ironPostPProduceDemand"] = d["ironProduceDemand"]\n    d["ironRawProduceDemand"] = d["ironPostPProduceDemand"] * settings["ironRawToIronPostP"]\n    d["ironPrePProduceDemand"] = d["ironRawProduceDemand"] * settings["ironPrePToIronRaw"]\n\n    d["ironPrePWaterDemand"] = calcProduceInputDemand(d["ironPrePProduceDemand"],settings["waterToIronPreP"])\n    d["ironRawWaterDemand"] = calcProduceInputDemand(d["ironRawProduceDemand"],settings["waterToIronRaw"])\n    d["ironPostPWaterDemand"] = calcProduceInputDemand(d["ironPostPProduceDemand"],settings["waterToIronPostP"])\n    d["ironWaterDemand"] = d["ironPrePWaterDemand"] + d["ironRawWaterDemand"] + d["ironPostPWaterDemand"]\n\n    d["ironPrePH2Demand"] = calcProduceInputDemand(d["ironPrePProduceDemand"],settings["h2ToIronPreP"])\n    d["ironRawH2Demand"] = calcProduceInputDemand(d["ironRawProduceDemand"], settings["h2ToIronRaw"])\n    d["ironPostPH2Demand"] = calcProduceInputDemand(d["ironPostPProduceDemand"],settings["h2ToIronPostP"])\n    d["ironH2Demand"] = d["ironPrePH2Demand"] + d["ironRawH2Demand"] + d["ironPostPH2Demand"]\n\n    d["ironPrePElectricityDemand"] = calcProduceInputDemand(d["ironPrePProduceDemand"],settings["electricityToIronPreP"])\n    d["ironRawElectricityDemand"] = calcProduceInputDemand(d["ironRawProduceDemand"],settings["electricityToIronRaw"])\n    d["ironPostPElectricityDemand"] = calcProduceInputDemand(d["ironPostPProduceDemand"],settings["electricityToIronPostP"])\n    d["ironElectricityDemand"] = d["ironPrePElectricityDemand"] + d["ironRawElectricityDemand"] + d["ironPostPElectricityDemand"]\n\n    d["h2Demand"] = d["ironH2Demand"]\n\n    s["h2DistributeCapacity"] = d["h2Demand"]\n\n    d["h2DistributeDemand"] = calcDistributeDemand(s["h2DistributeCapacity"], d["h2Demand"])\n    d["h2BaseDemand"]= d["h2DistributeDemand"]\n    d["h2ProduceDemand"] = calcProduceDemand(settings["h2ProduceCapacity"], d["h2DistributeDemand"],0)\n    d["h2WaterDemand"] = calcProduceInputDemand(d["h2ProduceDemand"], settings["waterToH2"])\n    d["h2ElectricityDemand"] = calcProduceInputDemand(d["h2ProduceDemand"], settings["electricityToH2"])\n\n    d["waterDemand"] = d["h2WaterDemand"] + d["ironWaterDemand"]\n    \n    s["waterDistributeCapacity"] = settings["h2ProduceCapacity"]*settings["waterToH2"] + s["ironPrePProduceCapacity"]*settings["waterToIronPreP"] + s["ironRawProduceCapacity"]*settings["waterToIronRaw"] + s["ironPostPProduceCapacity"]*settings["waterToIronPostP"]\n    \n #   s["waterDistributeCapacity"] = settings["h2ProduceCapacity"]*settings["waterToH2"] + settings["ironPrePProduceCapacity"]*settings["waterToIronPreP"] + settings["ironRawProduceCapacity"]*settings["waterToIronRaw"] + settings["ironPostPProduceCapacity"]*settings["waterToIronPostP"]    \n    \n    s["waterProduceCapacity"] = s["waterDistributeCapacity"]\n    s["waterStoreCapacity"] = 5 * s["waterProduceCapacity"]\n    # s["waterStoreCapacity"] = 500 line if experimenting with limiting water store capacity\n\n    d["waterDistributeDemand"] = calcDistributeDemand(s["waterDistributeCapacity"], d["waterDemand"])\n    d["waterBaseDemand"] = d["waterDistributeDemand"]\n    d["waterBaseDemand"] = d["waterDistributeDemand"]\n    d["waterBaseDemand"] = d["waterDistributeDemand"]\n    d["waterProduceDemand"] = calcProduceDemand(s["waterProduceCapacity"], d["waterDistributeDemand"], 0)\n    d["waterElectricityDemand"] = calcProduceInputDemand(d["waterProduceDemand"], settings["electricityToWater"])\n\n    d["electricityDemand"] = d["waterElectricityDemand"] + d["h2ElectricityDemand"] + d["ironElectricityDemand"]\n\n    s["electricityDistributeCapacity"] = s["waterProduceCapacity"]*settings["electricityToWater"] + settings["h2ProduceCapacity"]*settings["electricityToH2"] + s["ironPrePProduceCapacity"]*settings["electricityToIronPreP"] + s["ironRawProduceCapacity"]*settings["electricityToIronRaw"] + s["ironPostPProduceCapacity"]*settings["electricityToIronPostP"]\n\n #   s["electricityDistributeCapacity"] = s["waterProduceCapacity"]*settings["electricityToWater"] + settings["h2ProduceCapacity"]*settings["electricityToH2"] + settings["ironPrePProduceCapacity"]*settings["electricityToIronPreP"] + settings["ironRawProduceCapacity"]*settings["electricityToIronRaw"] + settings["ironPostPProduceCapacity"]*settings["electricityToIronPostP"]\n\n\n    d["electricityDistributeDemand"] = calcDistributeDemand(s["electricityDistributeCapacity"], d["electricityDemand"])\n    d["electricityBaseDemand"] = d["electricityDistributeDemand"]\n\n    return s, d\n');__stickytape_write_module('model/functions.py',b'def calcDistributeDemand(\n    distributeCapacity, consumer1Demand=0, consumer2Demand=0, consumer3Demand=0\n):\n    return min(distributeCapacity, consumer1Demand + consumer2Demand + consumer3Demand)\n\n\ndef calcStoreDemand(storeCapacity, storeLevel, storeMaxChargeRate):\n    return min(storeCapacity - storeLevel,storeMaxChargeRate * storeCapacity)\n\n\ndef calcProduceDemand(produceCapacity, distributeDemand, storeDemand):\n    return min(produceCapacity, distributeDemand + storeDemand)\n\n\ndef calcProduceInputDemand(produceDemand, inputToOutputFactor):\n    return produceDemand * inputToOutputFactor\n\n\ndef calcProduceOutput(\n    produceDemand,\n    input1Supply,\n    input1ToOutput1Factor,\n    input2Supply = 0,\n    input2ToOutput1Factor = 0,\n    input3Supply = 0,\n    input3ToOutput1Factor = 0,\n    input4Supply = 0,\n    input4ToOutput1Factor = 0,\n    input5Supply = 0,\n    input5ToOutput1Factor = 0,\n    input6Supply = 0,\n    input6ToOutput1Factor = 0,\n):\n    a = 1000000\n    b = 1000000\n    c = 1000000\n    d = 1000000\n    e = 1000000\n    f = 1000000\n    \n    if input1ToOutput1Factor > 0:\n        a = input1Supply / input1ToOutput1Factor\n\n    if input2ToOutput1Factor > 0:\n        b = input2Supply / input2ToOutput1Factor\n\n    if input3ToOutput1Factor > 0:\n        c = input3Supply / input3ToOutput1Factor\n\n    if input4ToOutput1Factor > 0:\n        d = input4Supply / input4ToOutput1Factor\n    \n    if input5ToOutput1Factor > 0:\n        d = input5Supply / input5ToOutput1Factor\n\n    if input6ToOutput1Factor > 0:\n        d = input6Supply / input6ToOutput1Factor   \n    \n    return min(produceDemand, a, b, c, d, e, f)\n\n\ndef calcProduceInputSupply(upstreamDistributeOutput, produceInputDemand, reipDemand):\n    return upstreamDistributeOutput * (produceInputDemand / reipDemand)\n\n\ndef calcProduceInputUsed(\n    produceOutput,\n    produceInput1Supply,\n    input1ToOutput1Factor,\n    produceInput2Supply = 0,\n    input2ToOutput1Factor = 0,\n    produceInput3Supply = 0,\n    input3ToOutput1Factor = 0,\n    produceInput4Supply = 0,\n    input4ToOutput1Factor = 0,\n    produceInput5Supply = 0,\n    input5ToOutput1Factor = 0,\n    produceInput6Supply = 0,\n    input6ToOutput1Factor = 0,    \n):\n    a = produceOutput * input1ToOutput1Factor\n    b = 1000000\n    c = 1000000\n    d = 1000000\n    e = 1000000\n    f = 1000000\n\n    if input2ToOutput1Factor > 0:\n        b = (produceInput2Supply / input2ToOutput1Factor) * input1ToOutput1Factor\n\n    if input3ToOutput1Factor > 0:\n        c = (produceInput3Supply / input3ToOutput1Factor) * input1ToOutput1Factor\n\n    if input4ToOutput1Factor > 0:\n        d = (produceInput4Supply / input4ToOutput1Factor) * input1ToOutput1Factor\n\n    if input5ToOutput1Factor > 0:\n        d = (produceInput5Supply / input4ToOutput1Factor) * input1ToOutput1Factor\n\n    if input6ToOutput1Factor > 0:\n        d = (produceInput6Supply / input4ToOutput1Factor) * input1ToOutput1Factor\n\n\n    return min(a, b, c, d, e ,f)\n\n\ndef calcStoreChange(\n    storeCapacity, storeMaxChargeRate, storeLevel, distributeDemand, produceOutput\n):\n    if distributeDemand > produceOutput:\n        return -1 * min(\n            storeMaxChargeRate * storeCapacity, storeLevel, distributeDemand - produceOutput\n        )\n    if distributeDemand < produceOutput:\n        return min(\n            storeMaxChargeRate * storeCapacity,\n            produceOutput - distributeDemand,\n            storeCapacity - storeLevel,\n        )\n    return 0\n\n\ndef calcStoreLevelNew(storeLevel, storeChange):\n    return storeLevel + storeChange\n\n\ndef calcDistributeOutput(distributeDemand, produceOutput, storeChange):\n    # if storeChange >= 0:\n    #     return min(\n    #         distributeDemand, produceOutput - storeChange\n    #     )\n    # if storeChange < 0:\n    return min(\n        distributeDemand, produceOutput - storeChange\n    )\n    \n');__stickytape_write_module('model/sim_phase_1.py',b'from model.sim_ammonia import simAmmoniaSupply\nfrom model.sim_electricity import simElectricityRawRenewableSupply, simElectricitySupply\nfrom model.sim_fertiliser import simFertiliserSupply\nfrom model.sim_grid_export import simGridExportSupply\nfrom model.sim_hydrogen import simHydrogenSupply\nfrom model.sim_initial_demand import simInitialDemands\nfrom model.sim_iron import simIronSupply\nfrom model.sim_lohc import simLohcSupply\nfrom model.sim_mp1 import simMp1Supply\nfrom model.sim_water import simWaterSupply\nfrom model.sim_grid_export import simGridExportSupply\nfrom model.update_used_quantities import updateUsedQuantities\n\n\ndef simPhase1(i, s, settings):\n\n    simInitialDemands(i, s, settings)\n    simElectricityRawRenewableSupply(i, s, settings)\n    simElectricitySupply(i, s, settings)\n    simWaterSupply(i, s, settings)\n    simHydrogenSupply(i, s, settings)\n    #simLohcSupply(i, s, settings)\n    #simAmmoniaSupply(i, s, settings)\n    #simFertiliserSupply(i, s, settings)\n    simIronSupply(i, s, settings)\n    #simMp1Supply(i, s, settings)\n    #simGridExportSupply(i, s, settings)\n    updateUsedQuantities(i, s, settings)\n    return True\n');__stickytape_write_module('model/sim_ammonia.py',b'from model.functions import (\n    calcDistributeOutput,\n    calcProduceDemand,\n    calcProduceInputSupply,\n    calcProduceInputUsed,\n    calcProduceOutput,\n    calcStoreChange,\n    calcStoreDemand,\n)\n\n\ndef simAmmoniaSupply(i, s, settings):\n    s["nh3StoreLevel"] = s["nh3StoreLevelDict"][i]\n    s["nh3DownstreamElectricityReservation"] = (\n        s["mp1ElectricityDemand"]\n        + s["ironElectricityDemand"]\n        + s["fertElectricityDemand"]\n        + s["gridExportElectricityDemand"]\n    )\n    s["nh3UpstreamElectricityUsed"] = (\n        s["waterElectricityUsed"] + s["h2ElectricityUsed"] + s["lohcElectricityUsed"]\n    )\n    s["nh3ElectricitySupply"] = max(\n        0,\n        s["electricityDistributeOutput"]\n        - s["nh3DownstreamElectricityReservation"]\n        - s["nh3UpstreamElectricityUsed"],\n    )\n    s["nh3H2Supply"] = calcProduceInputSupply(\n        s["h2DistributeOutput"], s["nh3H2Demand"], s["h2Demand"]\n    )\n    s["nh3StoreDemand"] = calcStoreDemand(\n        settings["nh3StoreCapacity"],\n        s["nh3StoreLevel"],\n        settings["nh3StoreMaxChargeRate"],\n    )\n    s["nh3ProduceDemand"] = calcProduceDemand(\n        settings["nh3ProduceCapacity"], s["nh3DistributeDemand"], s["nh3StoreDemand"]\n    )\n    s["nh3ProduceOutput"] = calcProduceOutput(\n        s["nh3ProduceDemand"],\n        s["nh3H2Supply"],\n        settings["h2ToNh3"],\n        s["nh3ElectricitySupply"],\n        settings["electricityToNh3"]\n    )\n    s["nh3ElectricityUsed"] = calcProduceInputUsed(\n        s["nh3ProduceOutput"],\n        s["nh3ElectricitySupply"],\n        settings["electricityToNh3"],\n        s["nh3H2Supply"],\n        settings["h2ToNh3"]\n    )\n    s["nh3H2Used"] = calcProduceInputUsed(\n        s["nh3ProduceOutput"],\n        s["nh3H2Supply"],\n        settings["h2ToNh3"],\n        s["nh3ElectricitySupply"],\n        settings["electricityToNh3"]\n    )\n    s["nh3StoreChange"] = calcStoreChange(\n        settings["nh3StoreCapacity"],\n        settings["nh3StoreMaxChargeRate"],\n        s["nh3StoreLevel"],\n        s["nh3DistributeDemand"],\n        s["nh3ProduceOutput"],\n    )\n    s["nh3DistributeOutput"] = calcDistributeOutput(\n        s["nh3DistributeDemand"], s["nh3ProduceOutput"], s["nh3StoreChange"]\n    )\n    return True\n');__stickytape_write_module('model/sim_electricity.py',b'from model.functions import calcDistributeOutput, calcStoreChange\n\n\ndef simElectricityRawRenewableSupply(i, s, settings):\n    s["electricityRawSolarPvOutput"] = (\n        settings["electricitySolarPvCapacity"] * s["solarPvMwPerMwCapacity"][i] * (1 - settings["electricitySolarPvLossFactor"])\n    )\n    s["electricityRawWindTurbinesOutput"] = (\n        settings["electricityWindTurbinesCapacity"] * s["windTurbinesMwPerMwCapacity"][i] * (1 - settings["electricityWindTurbinesLossFactor"])\n    )\n    s["electricityRawRenewableOutput"] = min(settings["electricityBtmTransmissionCapacity"],\n        s["electricityRawSolarPvOutput"] + s["electricityRawWindTurbinesOutput"]\n    )\n    return True\n\n\ndef simElectricitySupply(i, s, settings):\n\n    s["electricityRawRenewableOutput"] = s["electricityRawRenewableOutput"] * (1 - settings["electricityBtmTransmissionLossFactor"])\n    # Reduce store level to \'remove\' proportion of battery not available for use.\n    s["electricityStoreLevel"] = s["electricityStoreLevelDict"][i] - settings["electricityStoreCapacity"] * (1 - settings["electricityStoreMaxDepthOfDischarge"])\n    s["firmingAllowed"] = s["firmingAllowedDict"][i]\n    s["electricityStoreChange"] = calcStoreChange(\n        settings["electricityStoreCapacity"] * settings["electricityStoreMaxDepthOfDischarge"],\n        settings["electricityStoreMaxChargeRate"],\n        s["electricityStoreLevel"],\n        s["electricityDistributeDemand"],\n        s["electricityRawRenewableOutput"]\n    )\n\n    s["electricityDistributeRenewableOutput"] = max(0,calcDistributeOutput(\n        s["electricityDistributeDemand"],\n        s["electricityRawRenewableOutput"],\n        s["electricityStoreChange"] \n    ))\n\n    s["electricityProduceFirmingFull"] = s["firmingAllowed"] * max(\n        0, s["electricityDistributeDemand"] - s["electricityDistributeRenewableOutput"]\n    )\n\n    s["electricityProduceFirmingMinimum"] = max(0, -1 * s["firmingAllowed"] + 1) * (\n        s["waterElectricityDemand"] \n        + s["ironElectricityDemand"] \n    )\n    s["electricityProduceFirmingDemand"] = max(\n        s["electricityProduceFirmingFull"],\n        s["electricityProduceFirmingMinimum"]\n        - s["electricityDistributeRenewableOutput"],\n        0,\n    )\n    s["electricityProduceRenewableOutput"] = (\n        s["electricityDistributeRenewableOutput"] + s["electricityStoreChange"]\n    )\n\n    if s["electricityRawRenewableOutput"] > 0:\n        s["electricityProduceSolarPvOutput"] = s[\n            "electricityProduceRenewableOutput"\n        ] * (s["electricityRawSolarPvOutput"] / (s["electricityRawSolarPvOutput"]+s["electricityRawWindTurbinesOutput"]))\n        s["electricityProduceWindTurbinesOutput"] = s[\n            "electricityProduceRenewableOutput"\n        ] * (s["electricityRawWindTurbinesOutput"] / (s["electricityRawSolarPvOutput"]+s["electricityRawWindTurbinesOutput"]))\n    else:\n        s["electricityProduceSolarPvOutput"] = 0\n        s["electricityProduceWindTurbinesOutput"] = 0\n\n    s["electricityProduceSolarPvOutput"] = s["electricityProduceSolarPvOutput"] / (1 - settings["electricityBtmTransmissionLossFactor"])\n    s["electricityProduceWindTurbinesOutput"] = s["electricityProduceWindTurbinesOutput"] / (1 - settings["electricityBtmTransmissionLossFactor"])\n\n    s["electricityProduceFirmingOutput"] = min(\n        (settings["electricityGridCapacity"] + settings["electricityGasTurbinesCapacity"]),\n        s["electricityProduceFirmingDemand"],\n    )\n\n\n    s["electricityProduceGridOutput"] = min(\n        settings["electricityGridCapacity"], s["electricityProduceFirmingOutput"]\n    )\n\n    s["electricityGridWholesaleCost"] = s["electricityProduceGridOutput"] * s["electricityGridWholesalePrice"][i] \n\n    s["electricityGridNetworkCharge"] = s["electricityProduceGridOutput"] * settings["electricityGridNetworkVariableCharge"]*1000 + s["networkHourlyStandingCharge"] + s["electricityGridKvaCharge"][i]\n\n    s["electricityGridCost"] = s["electricityGridWholesaleCost"] + s["electricityGridNetworkCharge"]\n\n    s["electricityProduceGasTurbinesOutput"] = (\n        s["electricityProduceFirmingOutput"] - s["electricityProduceGridOutput"]\n    )\n\n    s["electricityProduceOutput"] = (\n        s["electricityProduceRenewableOutput"] + s["electricityProduceFirmingOutput"]\n    )\n    s["electricityDistributeOutput"] = calcDistributeOutput(\n        s["electricityDistributeDemand"],\n        s["electricityProduceOutput"],\n        s["electricityStoreChange"]\n    )\n\n    s["electricityProduceGridEmissions"] = (\n        s["electricityProduceGridOutput"] * s["electricityGridEmissionsFactor"][i]\n    )\n\n    s["electricityProduceGasTurbinesNaturalGas"] = s["electricityProduceGasTurbinesOutput"] * settings["naturalGasToElectricity"]\n\n    s["electricityProduceGasTurbinesEmissions"] = s["electricityProduceGasTurbinesNaturalGas"] / settings["naturalGasToEmissions"]\n    s["electricityProduceFirmingEmissions"] = (\n        s["electricityProduceGridEmissions"]\n        + s["electricityProduceGasTurbinesEmissions"]\n    )\n\n    s["electricityDistributeEmissions"] = s["electricityProduceFirmingEmissions"]\n    if s["electricityDistributeEmissions"] == 0:\n        s["electricityDistributeEmissionsIntensity"] = 0\n    if s["electricityDistributeOutput"] == 0:\n        s["electricityDistributeEmissionsIntensity"] = 0\n    else:\n        s["electricityDistributeEmissionsIntensity"] = (\n            s["electricityDistributeEmissions"] / s["electricityDistributeOutput"]\n        )\n    return True\n');__stickytape_write_module('model/sim_fertiliser.py',b'from model.functions import (\n    calcDistributeOutput,\n    calcProduceDemand,\n    calcProduceInputUsed,\n    calcProduceOutput,\n    calcStoreChange,\n    calcStoreDemand,\n)\n\n\ndef simFertiliserSupply(i, s, settings):\n    s["fertStoreLevel"] = s["fertStoreLevelDict"][i]\n    s["fertDownstreamElectricityReservation"] = (\n        s["mp1ElectricityDemand"] + s["ironElectricityDemand"] + s["gridExportElectricityDemand"]\n    )\n    s["fertUpstreamElectricityUsed"] = (\n        s["waterElectricityUsed"]\n        + s["h2ElectricityUsed"]\n        + s["lohcElectricityUsed"]\n        + s["nh3ElectricityUsed"]\n    )\n    s["fertElectricitySupply"] = max(\n        0,\n        s["electricityDistributeOutput"]\n        - s["nh3DownstreamElectricityReservation"]\n        - s["nh3UpstreamElectricityUsed"],\n    )\n    s["fertNh3Supply"] = min(\n        s["nh3DistributeOutput"], s["fertNh3Demand"]\n    )  # Different to other value chains - Fertiliser will consume as much Nh3 as can\n    s["fertStoreDemand"] = calcStoreDemand(\n        settings["fertStoreCapacity"],\n        s["fertStoreLevel"],\n        settings["fertStoreMaxChargeRate"],\n    )\n    s["fertProduceDemand"] = calcProduceDemand(\n        settings["fertProduceCapacity"], s["fertDistributeDemand"], s["fertStoreDemand"]\n    )\n    s["fertProduceOutput"] = calcProduceOutput(\n        s["fertProduceDemand"],\n        s["fertNh3Supply"],\n        settings["nh3ToFert"],\n        s["fertElectricitySupply"],\n        settings["electricityToFert"]\n    )\n    s["fertElectricityUsed"] = calcProduceInputUsed(\n        s["fertProduceOutput"],\n        s["fertElectricitySupply"],\n        settings["electricityToFert"],\n        s["fertNh3Supply"],\n        settings["nh3ToFert"]\n    )\n    s["fertNh3Used"] = calcProduceInputUsed(\n        s["fertProduceOutput"],\n        s["fertNh3Supply"],\n        settings["nh3ToFert"],\n        s["fertElectricitySupply"],\n        settings["electricityToFert"]\n    )\n    s["fertStoreChange"] = calcStoreChange(\n        settings["fertStoreCapacity"],\n        settings["fertStoreMaxChargeRate"],\n        s["fertStoreLevel"],\n        s["fertDistributeDemand"],\n        s["fertProduceOutput"],\n    )\n    s["fertDistributeOutput"] = calcDistributeOutput(\n        s["fertDistributeDemand"], s["fertProduceOutput"], s["fertStoreChange"]\n    )\n    return True\n');__stickytape_write_module('model/sim_grid_export.py',b'def simGridExportSupply(i, s, settings):\n\n    electricityUsedInReip = (\n        s["h2ElectricityUsed"]\n        + s["waterElectricityUsed"]\n    #    + s["lohcElectricityUsed"]\n    #    + s["nh3ElectricityUsed"]\n     #   + s["mp1ElectricityUsed"]\n        + s["ironElectricityUsed"]\n    #    + s["fertElectricityUsed"]\n    )\n\n    s["electricityGridExportUsed"] = 0\n    # settings["electricityGridCapacity"]\n    if settings["electricityGridCurtailedExportToggle"]:\n        s["electricityGridExportUsed"] = min(settings["electricityGridExportCapacity"], #1000000 to make exports unconstrained\n                                            s["electricityDistributeCapacity"] - electricityUsedInReip,\n                                            s["electricityRawRenewableOutput"] - s["electricityProduceRenewableOutput"]\n                                            )\n    \n    if s["electricityGridWholesalePrice"][i] < 0:\n        s["electricityGridExportUsed"] = 0\n\n    s["electricityGridRevenue"] = s["electricityGridExportUsed"] * s["electricityGridWholesalePrice"][i]\n\n    return True');__stickytape_write_module('model/sim_hydrogen.py',b'from model.functions import (\n    calcDistributeOutput,\n    calcProduceDemand,\n    calcProduceInputSupply,\n    calcProduceInputUsed,\n    calcProduceOutput,\n    calcStoreChange,\n    calcStoreDemand,\n)\n\n\ndef simHydrogenSupply(i, s, settings):\n    s["h2StoreLevel"] = s["h2StoreLevelDict"][i]\n    s["h2DownstreamElectricityReservation"] = (\n#        s["nh3ElectricityDemand"]\n#        + s["lohcElectricityDemand"]\n#        + s["mp1ElectricityDemand"]\n        + s["ironElectricityDemand"]\n#        + s["fertElectricityDemand"]\n#       + s["electricityGridExportDemand"]\n    )\n    s["h2UpstreamElectricityUsed"] = s["waterElectricityUsed"]\n    s["h2ElectricitySupply"] = max(\n        0,\n        s["electricityDistributeOutput"]\n        - s["h2DownstreamElectricityReservation"]\n        - s["h2UpstreamElectricityUsed"],\n    )\n    s["h2WaterSupply"] = calcProduceInputSupply(\n        s["waterDistributeOutput"], s["h2WaterDemand"], s["waterDistributeDemand"]\n    )\n    s["h2StoreDemand"] = calcStoreDemand(\n        settings["h2StoreCapacity"], s["h2StoreLevel"], settings["h2StoreMaxChargeRate"]\n    )\n\n    s["h2ProduceDemand"] = calcProduceDemand(\n        settings["h2ProduceCapacity"], s["h2DistributeDemand"], s["h2StoreDemand"]\n    )\n\n    if s["electricityGridEconomicExport"]: # Don\'t think required => and settings["electricityGridCurtailedExportToggle"]):\n        s["h2ProduceDemand"] = 0\n\n    s["h2ProduceOutput"] = calcProduceOutput(\n        s["h2ProduceDemand"],\n        s["h2WaterSupply"],\n        settings["waterToH2"],\n        s["h2ElectricitySupply"],\n        settings["electricityToH2"]\n    )\n\n    s["h2ElectricityUsed"] = calcProduceInputUsed(\n        s["h2ProduceOutput"],\n        s["h2ElectricitySupply"],\n        settings["electricityToH2"],\n        s["h2WaterSupply"],\n        settings["waterToH2"]\n    )\n    s["h2WaterUsed"] = calcProduceInputUsed(\n        s["h2ProduceOutput"],\n        s["h2WaterSupply"],\n        settings["waterToH2"],\n        s["h2ElectricitySupply"],\n        settings["electricityToH2"]\n    )\n    s["h2StoreChange"] = calcStoreChange(\n        settings["h2StoreCapacity"],\n        settings["h2StoreMaxChargeRate"],\n        s["h2StoreLevel"],\n        s["h2DistributeDemand"],\n        s["h2ProduceOutput"],\n    )\n    s["h2DistributeOutput"] = calcDistributeOutput(\n        s["h2DistributeDemand"], s["h2ProduceOutput"], s["h2StoreChange"]\n    )\n    return True\n');__stickytape_write_module('model/sim_initial_demand.py',b'\nfrom model.functions import (\n    calcDistributeDemand,\n    calcProduceDemand,\n    calcProduceInputDemand,\n    calcStoreDemand,\n)\n\n# def electricityPriceCheck\n\ndef simInitialDemands(i, s, settings):\n\n\n    s["electricityGridEconomicExport"] = False\n    s["electricityGridExportDemand"] = 0\n\n    if (s["electricityGridWholesalePrice"][i] > s["electricityGridBreakevenPrice"]) and (settings["electricityGridEconomicExportToggle"] == True):\n        s["electricityGridEconomicExport"] = True\n        s["electricityGridExportDemand"] = settings["electricityGridCapacity"]\n\n    if not settings["electricityGridCurtailedExportToggle"]:\n        s["electricityGridExportDemand"] = 0\n\n    s["ironDistributeDemand"] = s["ironDistributeCapacity"]\n\n    s["ironProduceDemand"] = calcProduceDemand(\n        settings["ironProduceCapacity"], s["ironDistributeDemand"], 0\n    )\n    s["ironPostPProduceDemand"] = s["ironProduceDemand"]\n    s["ironRawProduceDemand"] = s["ironPostPProduceDemand"] * settings["ironRawToIronPostP"]\n    s["ironPrePProduceDemand"] = s["ironRawProduceDemand"] * settings["ironPrePToIronRaw"]\n\n    s["ironPrePWaterDemand"] = calcProduceInputDemand(\n        s["ironPrePProduceDemand"], settings["waterToIronPreP"]\n    )                                              \n    s["ironRawWaterDemand"] = calcProduceInputDemand(\n        s["ironRawProduceDemand"], settings["waterToIronRaw"]\n    )\n    s["ironPostPWaterDemand"] = calcProduceInputDemand(\n        s["ironPostPProduceDemand"], settings["waterToIronPostP"]\n    )      \n    s["ironWaterDemand"] =  s["ironPrePWaterDemand"] + s["ironRawWaterDemand"] + s["ironPostPWaterDemand"] \n\n    s["ironPrePH2Demand"] = calcProduceInputDemand(\n        s["ironPrePProduceDemand"], settings["h2ToIronPreP"]\n    )                                              \n    s["ironRawH2Demand"] = calcProduceInputDemand(\n        s["ironRawProduceDemand"], settings["h2ToIronRaw"]\n    )\n    s["ironPostPH2Demand"] = calcProduceInputDemand(\n        s["ironPostPProduceDemand"], settings["h2ToIronPostP"]\n    )      \n    s["ironH2Demand"] =  s["ironPrePH2Demand"] + s["ironRawH2Demand"] + s["ironPostPH2Demand"]    \n\n    s["ironPrePElectricityDemand"] = calcProduceInputDemand(\n        s["ironPrePProduceDemand"], settings["electricityToIronPreP"]\n    )                                              \n    s["ironRawElectricityDemand"] = calcProduceInputDemand(\n        s["ironRawProduceDemand"], settings["electricityToIronRaw"]\n    )\n    s["ironPostPElectricityDemand"] = calcProduceInputDemand(\n        s["ironPostPProduceDemand"], settings["electricityToIronPostP"]\n    )      \n    s["ironElectricityDemand"] =  s["ironPrePElectricityDemand"] + s["ironRawElectricityDemand"] + s["ironPostPElectricityDemand"]    \n\n    s["h2Demand"] = s["ironH2Demand"] \n\n    s["h2DistributeDemand"] = calcDistributeDemand(s["h2DistributeCapacity"]\n        , s["h2Demand"]\n    )\n    s["h2StoreDemand"] = calcStoreDemand(\n        settings["h2StoreCapacity"], s["h2StoreLevel"], settings["h2StoreMaxChargeRate"]\n    )\n    s["h2ProduceDemand"] = calcProduceDemand(\n        settings["h2ProduceCapacity"], s["h2DistributeDemand"], s["h2StoreDemand"]\n    )\n\n    s["h2WaterDemand"] = calcProduceInputDemand(\n        s["h2ProduceDemand"], settings["waterToH2"]\n    )\n    s["h2ElectricityDemand"] = calcProduceInputDemand(\n        s["h2ProduceDemand"], settings["electricityToH2"]\n    )\n    s["waterDemand"] = s["h2WaterDemand"] + s["ironWaterDemand"]\n    s["waterDistributeDemand"] = calcDistributeDemand(\n        s["waterDistributeCapacity"], s["waterDemand"]\n    )\n    s["waterStoreDemand"] = calcStoreDemand(\n        s["waterStoreCapacity"],\n        s["waterStoreLevel"],\n        s["waterStoreCapacity"],\n    )\n    s["waterProduceDemand"] = calcProduceDemand(\n        s["waterProduceCapacity"],\n        s["waterDistributeDemand"],\n        s["waterStoreDemand"],\n    )\n    s["waterElectricityDemand"] = calcProduceInputDemand(\n        s["waterProduceDemand"], settings["electricityToWater"]\n    )\n    s["electricityDemand"] = (\n        s["waterElectricityDemand"]\n        + s["h2ElectricityDemand"]\n#        + s["mp1ElectricityDemand"]\n#        + s["nh3ElectricityDemand"]\n#        + s["lohcElectricityDemand"]\n        + s["ironElectricityDemand"]\n#        + s["fertElectricityDemand"]\n        + s["electricityGridExportDemand"]\n    )\n    s["electricityDistributeDemand"] = calcDistributeDemand(\n        s["electricityDistributeCapacity"], s["electricityDemand"]\n    )\n\n    s["electricityGridExportUsed"] = 0\n\n    return True\n');__stickytape_write_module('model/sim_iron.py',b'from model.functions import (\n    calcDistributeOutput,\n    calcProduceDemand,\n    calcProduceInputSupply,\n    calcProduceInputUsed,\n    calcProduceOutput,\n    calcStoreChange,\n    calcStoreDemand,\n)\n\n\ndef simIronSupply(i, s, settings):\n    s["ironDownstreamElectricityReservation"] =  0 #s["electricityGridExportDemand"] \n    # + s["mp1ElectricityDemand"]\n    s["ironUpstreamElectricityUsed"] = (\n        s["waterElectricityUsed"]\n        + s["h2ElectricityUsed"]\n    #    + s["lohcElectricityUsed"]\n    #    + s["nh3ElectricityUsed"]\n    #    + s["fertElectricityUsed"]\n    )\n\n#---------\n\n    s["ironProduceDemand"] = calcProduceDemand(\n        settings["ironProduceCapacity"], s["ironDistributeDemand"], 0\n    )\n\n    s["ironPostPProduceDemand"] = s["ironProduceDemand"]\n    s["ironRawProduceDemand"] = s["ironPostPProduceDemand"] * settings["ironRawToIronPostP"]\n    s["ironPrePProduceDemand"] = s["ironRawProduceDemand"] * settings["ironPrePToIronRaw"]\n\n    s["ironElectricitySupply"] = max(\n        0,\n        s["electricityDistributeOutput"]\n        - s["ironDownstreamElectricityReservation"]\n        - s["ironUpstreamElectricityUsed"],\n    )\n    \n    s["ironPrePElectricitySupply"] = s["ironElectricitySupply"] * (s["ironPrePProduceDemand"]*settings["electricityToIronPreP"]  / (s["ironPrePProduceDemand"]*settings["electricityToIronPreP"] + s["ironRawProduceDemand"]*settings["electricityToIronRaw"] + s["ironPostPProduceDemand"]*settings["electricityToIronPostP"]))\n\n    s["ironPrePH2Supply"] = calcProduceInputSupply(\n        s["h2DistributeOutput"], s["ironPrePH2Demand"], s["h2DistributeDemand"]\n    )\n    s["ironPrePWaterSupply"] = calcProduceInputSupply(\n        s["waterDistributeOutput"], s["ironPrePWaterDemand"], s["waterDistributeDemand"]\n    )\n\n    s["ironPrePProduceOutput"] = calcProduceOutput(\n        s["ironPrePProduceDemand"],\n        s["ironPrePH2Supply"],\n        settings["h2ToIronPreP"],\n        s["ironPrePElectricitySupply"],\n        settings["electricityToIronPreP"],\n        s["ironPrePWaterSupply"],\n        settings["waterToIronPreP"],\n    )\n\n    s["ironPrePElectricityUsed"] = calcProduceInputUsed(\n        s["ironPrePProduceOutput"],\n        s["ironPrePElectricitySupply"],\n        settings["electricityToIronPreP"],\n        s["ironPrePH2Supply"],\n        settings["h2ToIronPreP"],\n        s["ironPrePWaterSupply"],\n        settings["waterToIronPreP"],\n    )\n    s["ironPrePH2Used"] = calcProduceInputUsed(\n        s["ironPrePProduceOutput"],\n        s["ironPrePH2Supply"],\n        settings["h2ToIronPreP"],\n        s["ironPrePElectricitySupply"],\n        settings["electricityToIronPreP"],\n        s["ironPrePWaterSupply"],\n        settings["waterToIronPreP"],\n    )\n    s["ironPrePWaterUsed"] = calcProduceInputUsed(\n        s["ironPrePProduceOutput"],\n        s["ironPrePWaterSupply"],\n        settings["waterToIronPreP"],\n        s["ironPrePH2Supply"],\n        settings["h2ToIronPreP"],\n        s["ironPrePElectricitySupply"],\n        settings["electricityToIronPreP"],\n    )\n\n   \n    s["ironPrePNaturalGas"] = s["ironPrePProduceOutput"] * settings["naturalGasToIronPreP"]\n\n    s["ironPrePEmissions"] = s["ironPrePNaturalGas"] / settings["naturalGasToEmissions"]\n\n#---------\n\n     \n    s["ironRawElectricitySupply"] = s["ironElectricitySupply"] * (s["ironRawProduceDemand"]*settings["electricityToIronRaw"]  / (s["ironPrePProduceDemand"]*settings["electricityToIronPreP"] + s["ironRawProduceDemand"]*settings["electricityToIronRaw"] + s["ironPostPProduceDemand"]*settings["electricityToIronPostP"]))\n\n\n    s["ironRawH2Supply"] = calcProduceInputSupply(\n        s["h2DistributeOutput"], s["ironRawH2Demand"], s["h2DistributeDemand"]\n    )\n\n    ngReducingSupplyMax = max(0,settings["naturalGasConnectionCapacity"])*s["firmingAllowed"]\n    if settings["naturalGasToIronRawReducing"]==0:\n        ngReducingSupplyMaxH2Equivalent = 0\n    else:\n        ngReducingSupplyMaxH2Equivalent =  ngReducingSupplyMax /120 # 120 is the LHV energy content of hydrogen in GJ/t\n    ngReducingSupplyH2Equivalent = min(s["ironRawH2Demand"] - s["ironRawH2Supply"],ngReducingSupplyMaxH2Equivalent)\n\n    s["ironRawWaterSupply"] = calcProduceInputSupply(\n        s["waterDistributeOutput"], s["ironRawWaterDemand"], s["waterDistributeDemand"]\n    )\n\n    s["ironRawProduceOutput"] = calcProduceOutput(\n        s["ironRawProduceDemand"],\n        s["ironRawH2Supply"] + ngReducingSupplyH2Equivalent,\n        settings["h2ToIronRaw"],\n        s["ironRawElectricitySupply"],\n        settings["electricityToIronRaw"],\n        s["ironRawWaterSupply"],\n        settings["waterToIronRaw"],\n        s["ironPrePProduceOutput"],\n        settings["ironPrePToIronRaw"]\n    )\n\n    s["ironRawElectricityUsed"] = calcProduceInputUsed(\n        s["ironRawProduceOutput"],\n        s["ironRawElectricitySupply"],\n        settings["electricityToIronRaw"],\n        s["ironRawH2Supply"] + ngReducingSupplyH2Equivalent,\n        settings["h2ToIronRaw"],\n        s["ironRawWaterSupply"],\n        settings["waterToIronRaw"],\n    )\n    totalGasReducingUsedH2Equivalent = calcProduceInputUsed(\n        s["ironRawProduceOutput"],\n        s["ironRawH2Supply"],\n        settings["h2ToIronRaw"],\n        s["ironRawElectricitySupply"],\n        settings["electricityToIronRaw"],\n        s["ironRawWaterSupply"],\n        settings["waterToIronRaw"])\n    \n\n\n    s["ironRawH2Used"] = min(totalGasReducingUsedH2Equivalent, s["ironRawH2Supply"])\n\n    s["ngReducingUsedH2Equivalent"] = max(0,totalGasReducingUsedH2Equivalent - s["ironRawH2Used"])\n\n    if settings["naturalGasToIronRawReducing"]==0:\n        s["ironRawReducingNaturalGas"] = 0\n    else:\n        s["ironRawReducingNaturalGas"] = s["ngReducingUsedH2Equivalent"] * 120 # 120 is the LHV energy content of hydrogen in GJ/t\n\n    s["ironRawWaterUsed"] = calcProduceInputUsed(\n        s["ironRawProduceOutput"],\n        s["ironRawWaterSupply"],\n        settings["waterToIronRaw"],\n        s["ironRawH2Supply"] + ngReducingSupplyH2Equivalent,\n        settings["h2ToIronRaw"],\n        s["ironRawElectricitySupply"],\n        settings["electricityToIronRaw"],\n    )\n\n    # if settings["naturalGasToIronRawHeating"]==0:\n    #     s["ironRawHeatingNaturaGas"] = 0\n    s["ironRawHeatingNaturalGas"] = s["ironRawProduceOutput"] * settings["naturalGasToIronRawHeating"]\n\n    s["ironRawNaturalGas"] = s["ironRawHeatingNaturalGas"] + s["ironRawReducingNaturalGas"]\n\n    s["ironRawEmissions"] = s["ironRawNaturalGas"] / settings["naturalGasToEmissions"]\n\n    s["ironRawWaterOutput"] = s["ironRawProduceOutput"] / settings["ironRawToWater"]\n#---------\n\n    \n    s["ironPostPElectricitySupply"] = s["ironElectricitySupply"] * (s["ironPostPProduceDemand"]*settings["electricityToIronPostP"]  / (s["ironPrePProduceDemand"]*settings["electricityToIronPreP"] + s["ironRawProduceDemand"]*settings["electricityToIronRaw"] + s["ironPostPProduceDemand"]*settings["electricityToIronPostP"]))\n\n    s["ironPostPH2Supply"] = calcProduceInputSupply(\n        s["h2DistributeOutput"], s["ironPostPH2Demand"], s["h2DistributeDemand"]\n    )\n    s["ironPostPWaterSupply"] = calcProduceInputSupply(\n        s["waterDistributeOutput"], s["ironPostPWaterDemand"], s["waterDistributeDemand"]\n    )\n\n    s["ironPostPProduceOutput"] = calcProduceOutput(\n        s["ironPostPProduceDemand"],\n        s["ironPostPH2Supply"],\n        settings["h2ToIronPostP"],\n        s["ironPostPElectricitySupply"],\n        settings["electricityToIronPostP"],\n        s["ironPostPWaterSupply"],\n        settings["waterToIronPostP"],\n        s["ironRawProduceOutput"],\n        settings["ironRawToIronPostP"]\n    )\n\n    s["ironPostPElectricityUsed"] = calcProduceInputUsed(\n        s["ironPostPProduceOutput"],\n        s["ironPostPElectricitySupply"],\n        settings["electricityToIronPostP"],\n        s["ironPostPH2Supply"],\n        settings["h2ToIronPostP"],\n        s["ironPostPWaterSupply"],\n        settings["waterToIronPostP"],\n    )\n    s["ironPostPH2Used"] = calcProduceInputUsed(\n        s["ironPostPProduceOutput"],\n        s["ironPostPH2Supply"],\n        settings["h2ToIronPostP"],\n        s["ironPostPElectricitySupply"],\n        settings["electricityToIronPostP"],\n        s["ironPostPWaterSupply"],\n        settings["waterToIronPostP"],\n    )\n    s["ironPostPWaterUsed"] = calcProduceInputUsed(\n        s["ironPostPProduceOutput"],\n        s["ironPostPWaterSupply"],\n        settings["waterToIronPostP"],\n        s["ironPostPH2Supply"],\n        settings["h2ToIronPostP"],\n        s["ironPostPElectricitySupply"],\n        settings["electricityToIronPostP"],\n    )\n    # if settings["naturalGasToIronPostP"]==0:\n    #     s["ironPostPNaturaGas"] = 0\n    s["ironPostPNaturalGas"] = s["ironPostPProduceOutput"] * settings["naturalGasToIronPostP"]\n\n    s["ironPostPEmissions"] = s["ironPostPNaturalGas"] / settings["naturalGasToEmissions"]\n#--------\n\n    s["ironNaturalGas"] = s["ironPrePNaturalGas"] + s["ironRawNaturalGas"] + s["ironPostPNaturalGas"]\n    \n    s["ironEmissions"] = s["ironPrePEmissions"] + s["ironRawEmissions"] + s["ironPostPEmissions"]\n\n    s["ironH2Supply"] = s["ironPrePH2Supply"] + s["ironRawH2Supply"] + s["ironPostPH2Supply"] \n    \n    s["ironWaterSupply"] = s["ironPrePWaterSupply"] + s["ironRawWaterSupply"] + s["ironPostPWaterSupply"] \n\n    s["ironProduceOutput"] = s["ironPostPProduceOutput"]\n\n    s["ironElectricityUsed"] = s["ironPrePElectricityUsed"] + s["ironRawElectricityUsed"] + s["ironPostPElectricityUsed"]\n\n    s["ironH2Used"] = s["ironPrePH2Used"] + s["ironRawH2Used"] + s["ironPostPH2Used"]   \n\n    s["ironWaterUsed"] = s["ironPrePWaterUsed"] + s["ironRawWaterUsed"] + s["ironPostPWaterUsed"]\n\n    \n    s["ironDistributeOutput"] = calcDistributeOutput(\n        s["ironDistributeDemand"], s["ironProduceOutput"], 0\n    )\n    return True\n');__stickytape_write_module('model/sim_lohc.py',b'from model.functions import (\n    calcDistributeOutput,\n    calcProduceDemand,\n    calcProduceInputSupply,\n    calcProduceInputUsed,\n    calcProduceOutput,\n    calcStoreChange,\n    calcStoreDemand,\n)\n\n\ndef simLohcSupply(i, s, settings):\n    s["lohcStoreLevel"] = s["lohcStoreLevelDict"][i]\n    s["lohcDownstreamElectricityReservation"] = (\n        s["nh3ElectricityDemand"]\n        + s["mp1ElectricityDemand"]\n        + s["ironElectricityDemand"]\n        + s["fertElectricityDemand"]\n        + s["gridExportElectricityDemand"]\n    )\n    s["lohcUpstreamElectricityUsed"] = (\n        s["waterElectricityUsed"] + s["h2ElectricityUsed"]\n    )\n    s["lohcElectricitySupply"] = max(\n        0,\n        s["electricityDistributeOutput"]\n        - s["lohcDownstreamElectricityReservation"]\n        - s["lohcUpstreamElectricityUsed"],\n    )\n    s["lohcH2Supply"] = calcProduceInputSupply(\n        s["h2DistributeOutput"], s["lohcH2Demand"], s["h2Demand"]\n    )\n    s["lohcStoreDemand"] = calcStoreDemand(\n        settings["lohcStoreCapacity"],\n        s["lohcStoreLevel"],\n        settings["lohcStoreMaxChargeRate"],\n    )\n    s["lohcProduceDemand"] = calcProduceDemand(\n        settings["lohcProduceCapacity"], s["lohcDistributeDemand"], s["lohcStoreDemand"]\n    )\n    s["lohcProduceOutput"] = calcProduceOutput(\n        s["lohcProduceDemand"],\n        s["lohcH2Supply"],\n        settings["h2ToLohc"],\n        s["lohcElectricitySupply"],\n        settings["electricityToLohc"]\n    )\n    s["lohcElectricityUsed"] = calcProduceInputUsed(\n        s["lohcProduceOutput"],\n        s["lohcElectricitySupply"],\n        settings["electricityToLohc"],\n        s["lohcH2Supply"],\n        settings["h2ToLohc"]\n    )\n    s["lohcH2Used"] = calcProduceInputUsed(\n        s["lohcProduceOutput"],\n        s["lohcH2Supply"],\n        settings["h2ToLohc"],\n        s["lohcElectricitySupply"],\n        settings["electricityToLohc"]\n    )\n    s["lohcStoreChange"] = calcStoreChange(\n        settings["lohcStoreCapacity"],\n        settings["lohcStoreMaxChargeRate"],\n        s["lohcStoreLevel"],\n        s["lohcDistributeDemand"],\n        s["lohcProduceOutput"],\n    )\n    s["lohcDistributeOutput"] = calcDistributeOutput(\n        s["lohcDistributeDemand"], s["lohcProduceOutput"], s["lohcStoreChange"]\n    )\n    return True\n');__stickytape_write_module('model/sim_mp1.py',b'from model.functions import (\n    calcDistributeOutput,\n    calcProduceDemand,\n    calcProduceInputUsed,\n    calcProduceOutput,\n    calcStoreChange,\n    calcStoreDemand,\n)\n\n\ndef simMp1Supply(i, s, settings):\n    s["mp1StoreLevel"] = s["mp1StoreLevelDict"][i]\n    s["mp1DownstreamElectricityReservation"] = + s["gridExportElectricityDemand"]\n    s["mp1UpstreamElectricityUsed"] = (\n        s["waterElectricityUsed"]\n        + s["h2ElectricityUsed"]\n        + s["lohcElectricityUsed"]\n        + s["nh3ElectricityUsed"]\n        + s["fertElectricityUsed"]\n        + s["ironElectricityUsed"]\n    )\n    s["mp1ElectricitySupply"] = max(\n        0,\n        s["electricityDistributeOutput"]\n        - s["mp1DownstreamElectricityReservation"]\n        - s["mp1UpstreamElectricityUsed"],\n    )\n    s["mp1StoreDemand"] = calcStoreDemand(\n        settings["mp1StoreCapacity"],\n        s["mp1StoreLevel"],\n        settings["mp1StoreMaxChargeRate"],\n    )\n    s["mp1ProduceDemand"] = calcProduceDemand(\n        settings["mp1ProduceCapacity"], s["mp1DistributeDemand"], s["mp1StoreDemand"]\n    )\n    s["mp1ProduceOutput"] = calcProduceOutput(\n        s["mp1ProduceDemand"],\n        s["mp1ElectricitySupply"],\n        settings["electricityToMp1"]\n    )\n    s["mp1ElectricityUsed"] = calcProduceInputUsed(\n        s["mp1ProduceOutput"],\n        s["mp1ElectricitySupply"],\n        settings["electricityToMp1"]\n    )\n    s["mp1StoreChange"] = calcStoreChange(\n        settings["mp1StoreCapacity"],\n        settings["mp1StoreMaxChargeRate"],\n        s["mp1StoreLevel"],\n        s["mp1DistributeDemand"],\n        s["mp1ProduceOutput"],\n    )\n    s["mp1DistributeOutput"] = calcDistributeOutput(\n        s["mp1DistributeDemand"], s["mp1ProduceOutput"], s["mp1StoreChange"]\n    )\n    return True\n');__stickytape_write_module('model/sim_water.py',b'from model.functions import (\n    calcDistributeOutput,\n    calcProduceDemand,\n    calcProduceInputUsed,\n    calcProduceOutput,\n    calcStoreChange,\n    calcStoreDemand,\n)\n\n\ndef simWaterSupply(i, s, settings):\n    s["waterStoreLevel"] = s["waterStoreLevelDict"][i]\n    s["waterElectricitySupply"] = min(\n        s["electricityDistributeOutput"], s["waterElectricityDemand"]\n    )\n    s["waterStoreDemand"] = calcStoreDemand(\n        s["waterStoreCapacity"],\n        s["waterStoreLevel"],\n        s["waterStoreCapacity"],\n    )\n    s["waterProduceDemand"] = calcProduceDemand(\n        s["waterProduceCapacity"],\n        s["waterDistributeDemand"],\n        s["waterStoreDemand"],\n    )\n    s["waterProduceOutput"] = calcProduceOutput(\n        s["waterProduceDemand"],\n        s["waterElectricitySupply"],\n        settings["electricityToWater"]\n    )\n    s["waterElectricityUsed"] = calcProduceInputUsed(\n        s["waterProduceOutput"],\n        s["waterElectricitySupply"],\n        settings["electricityToWater"]\n    )\n    s["waterStoreChange"] = calcStoreChange(\n        s["waterStoreCapacity"],\n        s["waterStoreCapacity"],\n        s["waterStoreLevel"],\n        s["waterDistributeDemand"],\n        s["waterProduceOutput"],\n    )\n    s["waterDistributeOutput"] = calcDistributeOutput(\n        s["waterDistributeDemand"], s["waterProduceOutput"], s["waterStoreChange"]\n    )\n    return True\n');__stickytape_write_module('model/update_used_quantities.py',b'def updateUsedQuantities(i, s, settings):\n    s["waterUsed"] = s["h2WaterUsed"] + s["ironWaterUsed"]\n    s["electricityUsed"] = (\n        s["h2ElectricityUsed"]\n        + s["waterElectricityUsed"]\n       # + s["lohcElectricityUsed"]\n       # + s["nh3ElectricityUsed"]\n       # + s["mp1ElectricityUsed"]\n        + s["ironElectricityUsed"]\n       # + s["fertElectricityUsed"]\n        + s["electricityGridExportUsed"]\n    )\n\n    s["h2Used"] = s["ironH2Used"]\n    # s["lohcH2Used"]\n    #+ s["nh3H2Used"] \n     \n    #s["nh3Used"] = s["nh3DistributeOutput"]\n    s["electricityDistributeOutput"] = s["electricityDistributeOutput"] + s["electricityGridExportUsed"]\n    return True\n');__stickytape_write_module('model/sim_phase_2.py',b'from model.sim_ammonia import simAmmoniaSupply\nfrom model.sim_electricity import simElectricitySupply\nfrom model.sim_fertiliser import simFertiliserSupply\nfrom model.sim_hydrogen import simHydrogenSupply\nfrom model.sim_iron import simIronSupply\nfrom model.sim_lohc import simLohcSupply\nfrom model.sim_mp1 import simMp1Supply\nfrom model.sim_water import simWaterSupply\nfrom model.sim_grid_export import simGridExportSupply\nfrom model.update_demands import updateDemands\nfrom model.update_used_quantities import updateUsedQuantities\n\n\n\ndef simPhase2(i, s, settings):\n    updateDemands(i, s, settings)\n    simElectricitySupply(i, s, settings)\n    simWaterSupply(i, s, settings)\n    simHydrogenSupply(i, s, settings)\n   # simLohcSupply(i, s, settings)\n    #simAmmoniaSupply(i, s, settings)\n    #simFertiliserSupply(i, s, settings)\n    simIronSupply(i, s, settings)\n    #simMp1Supply(i, s, settings)\n    #simGridExportSupply(i, s, settings)\n    updateUsedQuantities(i, s, settings)\n    return True\n');__stickytape_write_module('model/update_demands.py',b'\nfrom model.functions import calcDistributeDemand\n\n\ndef updateDemands(i, s, settings):\n    \n    s["ironPrePElectricityDemand"] = s["ironPrePElectricityUsed"] + 0.0001\n    s["ironRawElectricityDemand"] = s["ironRawElectricityUsed"] + 0.0001\n    s["ironPostPElectricityDemand"] = s["ironPostPElectricityUsed"] + 0.0001\n\n    s["waterElectricityDemand"] = s["waterElectricityUsed"] + 0.0001\n    s["h2ElectricityDemand"] = s["h2ElectricityUsed"] + 0.0001\n    #s["lohcElectricityDemand"] = s["lohcElectricityUsed"] + 0.0001\n    #s["nh3ElectricityDemand"] = s["nh3ElectricityUsed"] + 0.0001\n #   s["mp1ElectricityDemand"] = s["mp1ElectricityUsed"] + 0.0001\n    s["ironElectricityDemand"] = s["ironElectricityUsed"] + 0.0001\n    #s["fertElectricityDemand"] = s["fertElectricityUsed"] + 0.0001\n    s["gridExportElectricityDemand"] = s["electricityGridExportUsed"] + 0.0001\n\n    s["h2WaterDemand"] = s["h2WaterUsed"] + 0.0001\n    s["ironWaterDemand"] = s["ironWaterUsed"] + 0.0001\n\n    #s["lohcH2Demand"] = s["lohcH2Used"] + 0.0001\n    #s["nh3H2Demand"] = s["nh3H2Used"] + 0.0001\n    s["ironH2Demand"] = s["ironH2Used"] + 0.0001 + s["ngReducingUsedH2Equivalent"]\n\n    #s["fertNh3Demand"] = s["fertNh3Used"] + 0.0001\n\n    s["electricityDemand"] = (\n        s["waterElectricityDemand"]\n        + s["h2ElectricityDemand"]\n    #    + s["lohcElectricityDemand"]\n    #    + s["nh3ElectricityDemand"]\n    #    + s["mp1ElectricityDemand"]\n        + s["ironElectricityDemand"]\n    #    + s["fertElectricityDemand"]\n        + s["gridExportElectricityDemand"]\n    )\n\n    s["electricityDistributeDemand"] = calcDistributeDemand(\n        s["electricityDistributeCapacity"], s["electricityDemand"]\n    )\n\n    s["waterDemand"] = s["h2WaterDemand"] + s["ironWaterDemand"]\n    s["waterDistributeDemand"] = s["waterDemand"]\n\n    s["h2Demand"] = s["ironH2Demand"]\n    #+ s["lohcH2Demand"] \n    #+ s["nh3H2Demand"] \n     \n    s["h2DistributeDemand"] = s["h2Demand"]\n\n    s["ironPrePH2Demand"] = s["ironPrePH2Used"] + 0.0001\n    s["ironRawH2Demand"] = s["ironRawH2Used"] + 0.0001 + s["ngReducingUsedH2Equivalent"]\n    s["ironPostPH2Demand"] = s["ironPostPH2Used"] + 0.0001    \n\n    s["ironPrePWaterDemand"] = s["ironPrePWaterUsed"] + 0.0001\n    s["ironRawWaterDemand"] = s["ironRawWaterUsed"] + 0.0001\n    s["ironPostPWaterDemand"] = s["ironPostPWaterUsed"] + 0.0001    \n\n    s["ironDistributeDemand"] = s["ironDistributeOutput"] + 0.0001\n\n    return True\n');__stickytape_write_module('model/sim_phase_3.py',b'from model.sim_ammonia import simAmmoniaSupply\nfrom model.sim_electricity import simElectricitySupply\nfrom model.sim_fertiliser import simFertiliserSupply\nfrom model.sim_hydrogen import simHydrogenSupply\nfrom model.sim_iron import simIronSupply\nfrom model.sim_lohc import simLohcSupply\nfrom model.sim_mp1 import simMp1Supply\nfrom model.sim_water import simWaterSupply\nfrom model.sim_grid_export import simGridExportSupply\nfrom model.update_demands import updateDemands\nfrom model.update_used_quantities import updateUsedQuantities\n\n\ndef simPhase3(i, s, settings):\n    updateDemands(i, s, settings)\n    simElectricitySupply(i, s, settings)\n    simWaterSupply(i, s, settings)\n    simHydrogenSupply(i, s, settings)\n    #simLohcSupply(i, s, settings)\n    #simAmmoniaSupply(i, s, settings)\n    #simFertiliserSupply(i, s, settings)\n    simIronSupply(i, s, settings)\n    #simMp1Supply(i, s, settings)\n    #simGridExportSupply(i, s, settings)\n    updateUsedQuantities(i, s, settings)\n    return True\n');__stickytape_write_module('model/sim_phase_4.py',b'from model.sim_ammonia import simAmmoniaSupply\nfrom model.sim_electricity import simElectricitySupply\nfrom model.sim_fertiliser import simFertiliserSupply\nfrom model.sim_hydrogen import simHydrogenSupply\nfrom model.sim_iron import simIronSupply\nfrom model.sim_lohc import simLohcSupply\nfrom model.sim_mp1 import simMp1Supply\nfrom model.sim_water import simWaterSupply\nfrom model.sim_grid_export import simGridExportSupply\nfrom model.update_demands import updateDemands\nfrom model.update_used_quantities import updateUsedQuantities\n\n\ndef simPhase4(i, s, settings):\n    updateDemands(i, s, settings)\n    simElectricitySupply(i, s, settings)\n    simWaterSupply(i, s, settings)\n    simHydrogenSupply(i, s, settings)\n    #simLohcSupply(i, s, settings)\n    #simAmmoniaSupply(i, s, settings)\n    #simFertiliserSupply(i, s, settings)\n    simIronSupply(i, s, settings)\n    #simMp1Supply(i, s, settings)\n    #simGridExportSupply(i, s, settings)\n    updateUsedQuantities(i, s, settings)\n    return True\n');__stickytape_write_module('model/sim_phase_5.py',b'from model.sim_ammonia import simAmmoniaSupply\nfrom model.sim_electricity import simElectricitySupply\nfrom model.sim_fertiliser import simFertiliserSupply\nfrom model.sim_hydrogen import simHydrogenSupply\nfrom model.sim_iron import simIronSupply\nfrom model.sim_lohc import simLohcSupply\nfrom model.sim_mp1 import simMp1Supply\nfrom model.sim_water import simWaterSupply\nfrom model.sim_grid_export import simGridExportSupply\nfrom model.update_demands import updateDemands\nfrom model.update_used_quantities import updateUsedQuantities\n\n\ndef simPhase5(i, s, settings):\n    updateDemands(i, s, settings)\n    simElectricitySupply(i, s, settings)\n    simWaterSupply(i, s, settings)\n    simHydrogenSupply(i, s, settings)\n    #simLohcSupply(i, s, settings)\n    #simAmmoniaSupply(i, s, settings)\n    #simFertiliserSupply(i, s, settings)\n    simIronSupply(i, s, settings)\n    #simMp1Supply(i, s, settings)\n    #simGridExportSupply(i, s, settings)\n    updateUsedQuantities(i, s, settings)\n    return True\n');__stickytape_write_module('model/sim_phase_6.py',b'from model.sim_ammonia import simAmmoniaSupply\nfrom model.sim_electricity import simElectricitySupply\nfrom model.sim_fertiliser import simFertiliserSupply\nfrom model.sim_hydrogen import simHydrogenSupply\nfrom model.sim_iron import simIronSupply\nfrom model.sim_lohc import simLohcSupply\nfrom model.sim_mp1 import simMp1Supply\nfrom model.sim_water import simWaterSupply\nfrom model.sim_grid_export import simGridExportSupply\nfrom model.update_demands import updateDemands\nfrom model.update_used_quantities import updateUsedQuantities\n\n\ndef simPhase6(i, s, settings):\n    updateDemands(i, s, settings)\n    simElectricitySupply(i, s, settings)\n    simWaterSupply(i, s, settings)\n    simHydrogenSupply(i, s, settings)\n    #simLohcSupply(i, s, settings)\n    #simAmmoniaSupply(i, s, settings)\n    #simFertiliserSupply(i, s, settings)\n    simIronSupply(i, s, settings)\n    #simMp1Supply(i, s, settings)\n    simGridExportSupply(i, s, settings)\n    updateUsedQuantities(i, s, settings)\n    return True\n');__stickytape_write_module('model/track_metrics.py',b'def trackMetrics(i, s):\n    s["electricityStoreChargeDict"][i] = s["electricityStoreCharge"]   \n    s["electricityStoreDischargeDict"][i] = s["electricityStoreDischarge"]\n\n    s["electricityGridNetworkChargeDict"][i] = s["electricityGridNetworkCharge"]\n    s["electricityGridWholesaleCostDict"][i] = s["electricityGridWholesaleCost"]\n    s["electricityDistributeDemandDict"][i] = s["electricityDistributeDemand"]\n    s["electricityDistributeOutputDict"][i] = s["electricityDistributeOutput"]\n    s["electricityDistributeRenewableOutputDict"][i] = s[\n        "electricityDistributeRenewableOutput"\n    ]\n    s["electricityProduceGridEmissionsDict"][i] = s["electricityProduceGridEmissions"]\n    s["electricityProduceGridOutputDict"][i] = s["electricityProduceGridOutput"]\n    s["electricityProduceGasTurbinesNaturalGasDict"][i] = s["electricityProduceGasTurbinesNaturalGas"]\n    s["electricityProduceGasTurbinesEmissionsDict"][i] = s[\n        "electricityProduceGasTurbinesEmissions"\n    ]\n    s["electricityProduceGasTurbinesOutputDict"][i] = s[\n        "electricityProduceGasTurbinesOutput"\n    ]\n    s["electricityProduceFirmingEmissionsDict"][i] = s[\n        "electricityProduceFirmingEmissions"\n    ]\n    s["electricityProduceFirmingOutputDict"][i] = s["electricityProduceFirmingOutput"]\n    s["electricityProduceRenewableOutputDict"][i] = s[\n        "electricityProduceRenewableOutput"\n    ]\n    s["electricityProduceFirmingDemandDict"][i] = s["electricityProduceFirmingDemand"]\n    s["electricityProduceFirmingFullDict"][i] = s["electricityProduceFirmingFull"]\n    s["electricityProduceFirmingMinimumDict"][i] = s["electricityProduceFirmingMinimum"]\n    s["firmingAllowedDict"][i] = s["firmingAllowed"]\n    \n    s["electricityProduceOutputDict"][i] = s["electricityProduceOutput"]\n    s["electricityProduceSolarPvOutputDict"][i] = s["electricityProduceSolarPvOutput"]\n    s["electricityProduceWindTurbinesOutputDict"][i] = s["electricityProduceWindTurbinesOutput"]\n    s["electricityRawRenewableOutputDict"][i] = s["electricityRawRenewableOutput"]\n    s["electricityRawSolarPvOutputDict"][i] = s["electricityRawSolarPvOutput"]\n    s["electricityRawWindTurbinesOutputDict"][i] = s["electricityRawWindTurbinesOutput"]\n    s["electricityUsedDict"][i] = s["electricityUsed"]\n\n    s["waterDistributeDemandDict"][i] = s["waterDistributeDemand"]\n    s["waterDistributeOutputDict"][i] = s["waterDistributeOutput"]\n    s["waterElectricityDemandDict"][i] = s["waterElectricityDemand"]\n    s["waterElectricityUsedDict"][i] = s["waterElectricityUsed"]\n    s["waterProduceOutputDict"][i] = s["waterProduceOutput"]\n    s["waterUsedDict"][i] = s["waterUsed"]\n\n    s["h2DistributeDemandDict"][i] = s["h2DistributeDemand"]\n    s["h2DistributeOutputDict"][i] = s["h2DistributeOutput"]\n    s["h2ElectricityDemandDict"][i] = s["h2ElectricityDemand"]\n    s["h2ElectricityUsedDict"][i] = s["h2ElectricityUsed"]\n    s["h2ProduceOutputDict"][i] = s["h2ProduceOutput"]\n    s["h2UsedDict"][i] = s["h2Used"]\n    s["h2WaterUsedDict"][i] = s["h2WaterUsed"]\n    \n #   s["lohcDistributeDemandDict"][i] = s["lohcDistributeDemand"]\n #   s["lohcDistributeOutputDict"][i] = s["lohcDistributeOutput"]\n #   s["lohcElectricityDemandDict"][i] = s["lohcElectricityDemand"]\n #   s["lohcElectricityUsedDict"][i] = s["lohcElectricityUsed"]\n #   s["lohcH2DemandDict"][i] = s["lohcH2Demand"]\n #   s["lohcH2UsedDict"][i] = s["lohcH2Used"]\n #   s["lohcProduceOutputDict"][i] = s["lohcProduceOutput"]\n\n  #  s["nh3DistributeDemandDict"][i] = s["nh3DistributeDemand"]\n  #  s["nh3DistributeOutputDict"][i] = s["nh3DistributeOutput"]\n  #  s["nh3ElectricityDemandDict"][i] = s["nh3ElectricityDemand"]\n  #  s["nh3ElectricityUsedDict"][i] = s["nh3ElectricityUsed"]\n  #  s["nh3H2DemandDict"][i] = s["nh3H2Demand"]\n  #  s["nh3H2UsedDict"][i] = s["nh3H2Used"]\n  #  s["nh3ProduceOutputDict"][i] = s["nh3ProduceOutput"]\n\n  #  s["fertDistributeDemandDict"][i] = s["fertDistributeDemand"]\n  #  s["fertDistributeOutputDict"][i] = s["fertDistributeOutput"]\n  #  s["fertElectricityDemandDict"][i] = s["fertElectricityDemand"]\n  #  s["fertElectricityUsedDict"][i] = s["fertElectricityUsed"]\n  #  s["fertNh3DemandDict"][i] = s["fertNh3Demand"]\n  #  s["fertNh3UsedDict"][i] = s["fertNh3Used"]\n  #  s["fertProduceOutputDict"][i] = s["fertProduceOutput"]\n\n  #  s["mp1DistributeDemandDict"][i] = s["mp1DistributeDemand"]\n  #  s["mp1DistributeOutputDict"][i] = s["mp1DistributeOutput"]\n  #  s["mp1ElectricityDemandDict"][i] = s["mp1ElectricityDemand"]\n  #  s["mp1ElectricityUsedDict"][i] = s["mp1ElectricityUsed"]\n  #  s["mp1ProduceOutputDict"][i] = s["mp1ProduceOutput"]\n\n    s["ironDistributeDemandDict"][i] = s["ironDistributeDemand"]\n    s["ironDistributeOutputDict"][i] = s["ironDistributeOutput"]\n    s["ironElectricityDemandDict"][i] = s["ironElectricityDemand"]\n    s["ironElectricityUsedDict"][i] = s["ironElectricityUsed"]\n    s["ironWaterUsedDict"][i] = s["ironWaterUsed"]\n    s["ironEmissionsIntensityYtdDict"][i] = s["ironEmissionsIntensityYtd"]\n    s["ironH2UsedDict"][i] = s["ironH2Used"]\n    s["ironProduceOutputDict"][i] = s["ironProduceOutput"]\n\n    s["ironPrePElectricityDemandDict"][i] = s["ironPrePElectricityDemand"]\n    s["ironPrePElectricityUsedDict"][i] = s["ironPrePElectricityUsed"]\n    s["ironPrePWaterUsedDict"][i] = s["ironPrePWaterUsed"]\n    s["ironPrePH2UsedDict"][i] = s["ironPrePH2Used"]\n    s["ironPrePProduceOutputDict"][i] = s["ironPrePProduceOutput"]\n    s["ironPrePNaturalGasDict"][i] = s["ironPrePNaturalGas"]\n    s["ironPrePEmissionsDict"][i] = s["ironPrePEmissions"]\n\n    s["ironRawElectricityDemandDict"][i] = s["ironRawElectricityDemand"]\n    s["ironRawElectricityUsedDict"][i] = s["ironRawElectricityUsed"]\n    s["ironRawWaterUsedDict"][i] = s["ironRawWaterUsed"]\n    s["ironRawH2UsedDict"][i] = s["ironRawH2Used"]\n    s["ironRawProduceOutputDict"][i] = s["ironRawProduceOutput"]\n    s["ironRawEmissionsDict"][i] = s["ironRawEmissions"]\n    s["ironRawReducingNaturalGasDict"][i] = s["ironRawReducingNaturalGas"]\n    s["ironRawHeatingNaturalGasDict"][i] = s["ironRawHeatingNaturalGas"]\n    s["ironRawNaturalGasDict"][i] = s["ironRawNaturalGas"]\n    s["ironRawWaterOutputDict"][i] = s["ironRawWaterOutput"]\n\n    s["ironPostPElectricityDemandDict"][i] = s["ironPostPElectricityDemand"]\n    s["ironPostPElectricityUsedDict"][i] = s["ironPostPElectricityUsed"]\n    s["ironPostPWaterUsedDict"][i] = s["ironPostPWaterUsed"]\n    s["ironPostPH2UsedDict"][i] = s["ironPostPH2Used"]\n    s["ironPostPProduceOutputDict"][i] = s["ironPostPProduceOutput"]\n    s["ironPostPNaturalGasDict"][i] = s["ironPostPNaturalGas"]\n    s["ironPostPEmissionsDict"][i] = s["ironPostPEmissions"]\n\n    s["ironNaturalGasDict"][i] = s["ironNaturalGas"]\n\n    s["ironEmissionsDict"][i] = s["ironEmissions"]\n\n    s["ironUpstreamEmissionsDict"][i] = s["ironUpstreamEmissions"]\n\n    s["cumulativeEmissionsAllowedDict"][i] = s["cumulativeEmissionsAllowed"]\n\n    s["electricityGridCostDict"][i] = s["electricityGridCost"]\n    s["electricityGridRevenueDict"][i] = s["electricityGridRevenue"]\n    s["electricityGridExportUsedDict"][i] = s["electricityGridExportUsed"]\n    s["electricityGridExportDemandDict"][i] = s["electricityGridExportDemand"]\n\n    s["electricityNetDict"][i] = s["electricityDistributeOutput"] - s["electricityUsed"]\n    s["waterNetDict"][i] = s["waterDistributeOutput"] - s["waterUsed"]\n    s["h2NetDict"][i] = s["h2DistributeOutput"] - s["h2Used"]\n\n    s["naturalGasTotalDict"][i] = s["electricityProduceGasTurbinesNaturalGas"] + s["ironNaturalGas"]\n    s[\'emissionsTotalDict\'][i] = s["electricityProduceFirmingEmissions"] + s["ironEmissions"]\n\n\n    return True\n');__stickytape_write_module('model/update_emissions_levels.py',b'def updateEmissionLevels(i, s, settings):\n    s["electricityProduceGridEmissions"] = (\n        s["electricityProduceGridOutput"] * s["electricityGridEmissionsFactor"][i]\n    )\n    s["electricityProduceGasTurbinesEmissions"] = (\n        s["electricityProduceGasTurbinesOutput"] * settings["naturalGasToElectricity"]\n    ) / settings["naturalGasToEmissions"]\n    s["electricityDistributeEmissions"] = (\n        s["electricityProduceGridEmissions"]\n        + s["electricityProduceGasTurbinesEmissions"]\n    )\n    if s["electricityDistributeEmissions"] == 0:\n        s["electricityDistributeEmissionsIntensity"] = 0\n    if s["electricityDistributeOutput"] == 0:\n        s["electricityDistributeEmissionsIntensity"] = 0\n    else:\n        s["electricityDistributeEmissionsIntensity"] = (\n            s["electricityDistributeEmissions"] / s["electricityDistributeOutput"]\n        )\n\n    s["waterCumulativeOutput"][i] = (\n        s["waterCumulativeOutput"].get(i - 1, 0) + s["waterDistributeOutput"]\n    )\n    s["h2CumulativeOutput"][i] = (\n        s["h2CumulativeOutput"].get(i - 1, 0) + s["h2DistributeOutput"]\n    )\n\n    s["ironCumulativeOutput"][i] = (\n        s["ironCumulativeOutput"].get(i - 1, 0) + s["ironDistributeOutput"]\n    )\n\n    s["ironUpstreamEmissions"] = s["ironPrePProduceOutput"] * settings["ironOreToIronPreP"] * settings["ironOreEmissionsIntensity"]\n\n    s["cumulativeEmissions"][i] = (\n        s["cumulativeEmissions"].get(i - 1, 0)\n        + s["electricityProduceGridEmissions"]\n        + s["electricityProduceGasTurbinesEmissions"]\n        + s["ironEmissions"]\n    )\n\n    s["cumulativeEmissionsAllowed"] = settings["ironEmissionsIntensityLimit"] * s["ironCumulativeOutput"][i]\n #       settings["lohcEmissionsIntensityLimit"] * s["lohcCumulativeOutput"][i]\n #       + settings["nh3EmissionsIntensityLimit"] * s["nh3CumulativeOutput"][i]\n #       + settings["mp1EmissionsIntensityLimit"] * s["mp1CumulativeOutput"][i]\n #       + settings["fertEmissionsIntensityLimit"] * s["fertCumulativeOutput"][i]\n    return True\n');__stickytape_write_module('model/update_firming_control.py',b'def updateFirmingControl(i, s):\n    s["firmingAllowedDict"][i + 1] = 1\n    if s["cumulativeEmissions"][i] > s["cumulativeEmissionsAllowed"]:\n        s["firmingAllowedDict"][i + 1] = 0\n    return True\n');__stickytape_write_module('model/update_store_levels.py',b'from model.functions import calcStoreLevelNew\n\n\ndef updateStoreLevels(i, s, settings):\n\n    electricityStoreLevelNew = calcStoreLevelNew(\n        s["electricityStoreLevel"], s["electricityStoreChange"]\n        )\n    s["electricityStoreCharge"] = 0\n    s["electricityStoreDischarge"] = 0\n    if s["electricityStoreChange"] >= 0:\n        s["electricityStoreCharge"] = s["electricityStoreChange"]\n    if s["electricityStoreChange"] < 0:\n        electricityStoreLevelNew = calcStoreLevelNew(\n            s["electricityStoreLevel"], s["electricityStoreChange"] / settings["electricityStoreRtEfficiency"]\n        )\n        s["electricityStoreDischarge"] = -1 * s["electricityStoreChange"] \n\n\n    s["electricityStoreLevelDict"][i + 1] = electricityStoreLevelNew + settings["electricityStoreCapacity"] * (1 - settings["electricityStoreMaxDepthOfDischarge"])\n\n    waterStoreLevelNew = min(s["waterStoreCapacity"],calcStoreLevelNew(s["waterStoreLevel"], s["waterStoreChange"]) + s["ironRawWaterOutput"])\n    s["waterStoreLevelDict"][i + 1] = waterStoreLevelNew\n\n    h2StoreLevelNew = calcStoreLevelNew(s["h2StoreLevel"], s["h2StoreChange"])\n    s["h2StoreLevelDict"][i + 1] = h2StoreLevelNew\n\n#    lohcStoreLevelNew = calcStoreLevelNew(s["lohcStoreLevel"], s["lohcStoreChange"])\n#    s["lohcStoreLevelDict"][i + 1] = lohcStoreLevelNew\n\n#   nh3StoreLevelNew = calcStoreLevelNew(s["nh3StoreLevel"], s["nh3StoreChange"])\n#    s["nh3StoreLevelDict"][i + 1] = nh3StoreLevelNew\n\n#    fertStoreLevelNew = calcStoreLevelNew(s["fertStoreLevel"], s["fertStoreChange"])\n#    s["fertStoreLevelDict"][i + 1] = fertStoreLevelNew\n\n #   mp1StoreLevelNew = calcStoreLevelNew(s["mp1StoreLevel"], s["mp1StoreChange"])\n #   s["mp1StoreLevelDict"][i + 1] = mp1StoreLevelNew\n\n\n    return True\n');__stickytape_write_module('results/results.py',b'\nfrom results.financial import financial_npv, financial_pmt\n\ndef reorder_dict_alphabetically(d):\n    return {k: d[k] for k in sorted(d)}\n\ndef multiplyArrayByConstant(array, constant):\n    for i in range(0, len(array)):\n        array[i] = array[i] * constant\n    return array\n\n\ndef create_results_object(s, settings):\n    results = {}\n\n    results["benchmarkEnergyInput"] = s["benchmarkEnergyInput"]\n    results["ironPriceAfterCarbon"] = s["ironPriceAfterCarbon"]\n    results["ironValueAdd"] = s["ironValueAdd"]\n    results["electricityGridBreakevenPrice"] = s["electricityGridBreakevenPrice"]\n    results["electricityGridWholesalePrice"] = s["electricityGridWholesalePrice"]\n    results["h2DistributeCapacity"] = s["h2DistributeCapacity"]\n    results["waterDistributeCapacity"] = s["waterDistributeCapacity"]\n    results["electricityDistributeCapacity"] = s["electricityDistributeCapacity"]\n    results["waterProduceCapacity"] = s["waterProduceCapacity"]\n    results["waterStoreCapacity"] = s["waterStoreCapacity"]\n    results["ironPrePProduceCapacity"] = s["ironPrePProduceCapacity"]\n    results["ironRawProduceCapacity"] = s["ironRawProduceCapacity"]\n    results["ironPostPProduceCapacity"] = s["ironPostPProduceCapacity"]\n    results["ironDistributeCapacity"] = s["ironDistributeCapacity"]\n\n\n\n    #\'empty\' used for plots\n    results["empty"] = multiplyArrayByConstant(list(range(0, settings["simLength"])), 0)\n    normalKeys = [\n        "cumulativeEmissions",\n        "h2CumulativeEmissions",\n        "h2CumulativeOutput",\n        "ironCumulativeEmissions",\n        "ironCumulativeOutput",\n       # "mp1CumulativeEmissions",\n       # "mp1CumulativeOutput",\n       # "nh3CumulativeEmissions",\n       # "nh3CumulativeOutput",\n       # "lohcCumulativeEmissions",\n       # "lohcCumulativeOutput",\n        "waterCumulativeEmissions",\n        "waterCumulativeOutput"\n    ]\n    dictKeys = [\n        "electricityGridNetworkCharge",\n        "electricityGridWholesaleCost",\n        "electricityDistributeDemand",\n        "electricityDistributeOutput",\n        "electricityDistributeRenewableOutput",\n        "electricityProduceGridEmissions",\n        "electricityProduceGridOutput",\n        "electricityProduceFirmingEmissions",\n        "firmingAllowed",\n        "electricityProduceFirmingDemand",\n        "electricityProduceFirmingFull",\n        "electricityProduceFirmingMinimum",\n        "electricityProduceFirmingOutput",\n        "electricityProduceGasTurbinesEmissions",\n        "electricityProduceGasTurbinesOutput",\n        "electricityProduceGasTurbinesNaturalGas",\n        "electricityProduceRenewableOutput",\n        "electricityProduceOutput",\n        "electricityProduceSolarPvOutput",\n        "electricityProduceWindTurbinesOutput",\n        "electricityRawRenewableOutput",\n        "electricityRawSolarPvOutput",\n        "electricityRawWindTurbinesOutput",\n        "electricityStoreLevel",\n        "electricityStoreCharge",\n        "electricityStoreDischarge",\n        "electricityUsed",\n        "h2DistributeDemand",\n        "h2DistributeOutput",\n        "h2ElectricityDemand",\n        "h2ElectricityUsed",\n        "h2ProduceOutput",\n        "h2StoreLevel",\n        "h2Used",\n        "h2WaterDemand",\n        "h2WaterUsed",\n        "ironDistributeDemand",\n        "ironDistributeOutput",\n        "ironElectricityDemand",\n        "ironElectricityUsed",\n        "ironH2Demand",\n        "ironH2Used",\n        "ironWaterUsed",\n        "ironProduceOutput",\n     #   "ironStoreLevel",\n        "ironPrePElectricityDemand",\n        "ironPrePElectricityUsed",\n        "ironPrePH2Demand",\n        "ironPrePH2Used",\n        "ironPrePWaterUsed",\n        "ironPrePProduceOutput",\n        "ironPrePNaturalGas",\n        "ironPrePEmissions",\n        "ironRawElectricityDemand",\n        "ironRawElectricityUsed",\n        "ironRawH2Demand",\n        "ironRawH2Used",\n        "ironRawWaterUsed",\n        "ironRawProduceOutput",\n        "ironRawHeatingNaturalGas",\n        "ironRawReducingNaturalGas",\n        "ironRawNaturalGas",\n        "ironRawEmissions",\n        "ironPostPElectricityDemand",\n        "ironPostPElectricityUsed",\n        "ironPostPH2Demand",\n        "ironPostPH2Used",\n        "ironPostPWaterUsed",\n        "ironPostPProduceOutput",\n        "ironPostPNaturalGas",\n        "ironPostPEmissions",\n     #   "mp1DistributeDemand",\n     #  "mp1DistributeOutput",\n     #   "mp1ElectricityDemand",\n     #   "mp1ElectricityUsed",\n     #   "mp1ProduceOutput",\n     #   "mp1StoreLevel",\n        # "nh3DistributeDemand",\n        # "nh3DistributeOutput",\n        # "nh3ElectricityDemand",\n        # "nh3ElectricityUsed",\n        # "nh3H2Demand",\n        # "nh3H2Used",\n        # "nh3ProduceOutput",\n        # "nh3StoreLevel",\n        # "lohcDistributeDemand",\n        # "lohcDistributeOutput",\n        # "lohcElectricityDemand",\n        # "lohcElectricityUsed",\n        # "lohcH2Demand",\n        # "lohcH2Used",\n        # "lohcProduceOutput",\n        # "lohcStoreLevel",\n        "waterDistributeDemand",\n        "waterDistributeOutput",\n        "waterElectricityDemand",\n        "waterElectricityUsed",\n        "waterProduceOutput",\n        "waterStoreLevel",\n        "waterUsed",\n        # "fertDistributeDemand",\n        # "fertDistributeOutput",\n        # "fertElectricityDemand",\n        # "fertElectricityUsed",\n        # "fertNh3Demand",\n        # "fertNh3Used",\n        # "fertProduceOutput",\n        # "fertStoreLevel",\n        "cumulativeEmissionsAllowed",\n        "electricityGridCost",\n        "electricityGridRevenue",\n        "electricityGridExportUsed",\n        "electricityGridExportDemand",\n        "electricityNet",\n        "waterNet",\n        "h2Net",\n        "naturalGasTotal",\n        "ironUpstreamEmissions",\n        "ironNaturalGas",\n        "ironEmissions",\n        "emissionsTotal",\n        "ironRawWaterOutput",\n    ]\n    \n    dictKeys = sorted(dictKeys)\n    \n    resultsKeys = []\n\n    for key in normalKeys:\n        results[key] = list(s[key].values())\n        resultsKeys.append(key)\n\n    for key in dictKeys:\n        newKey = key + "Dict"\n        results[key] = list(s[newKey].values())\n        resultsKeys.append(key)\n    \n    results = reorder_dict_alphabetically(results)\n\n    return results, resultsKeys\n\n\ndef annual_results(settings, results, resultsKeys, variablesUnits):\n    annualResults = {}\n\n    for i in range(len(resultsKeys)):\n        item = resultsKeys[i]\n        annualResults[item] = sum(results[item]) * settings["simLength"]/8760\n\n    annualResultsTable = list(range(0, len(resultsKeys)))\n\n    for i in range(len(resultsKeys)):\n        rowList = list(range(0, 3))\n        item = resultsKeys[i]\n        rowList[0] = item\n        rowList[1] = annualResults[item]\n        rowList[2] = variablesUnits.get(item, "")\n        annualResultsTable[i] = rowList\n\n    checks = {}\n\n    checks["electricitySum"] = annualResults["electricityDistributeOutput"] - annualResults["electricityUsed"]\n    checks["h2Sum"] = annualResults["h2DistributeOutput"] - annualResults["h2Used"]\n    checks["waterSum"] = annualResults["waterDistributeOutput"] - annualResults["waterUsed"]\n\n    return annualResults, checks\n\n\ndef cost_and_revenue(annualResults, settings, s):\n    capex = {}\n    # valueChains = ["electricity", "water", "h2", "lohc", "nh3", "fert", "iron", "mp1"]\n    \n    facilities = [\n        "electricitySolarPv",\n        "electricityWindTurbines",\n        "electricityGasTurbines",\n        "electricityStore",\n        #"electricityDistribute",\n        #"waterProduce",\n        #"waterStore",\n        #"waterDistribute",\n        "h2Produce",\n        "h2Store",\n        #"h2Distribute",\n        # "lohcProduce",\n        # "lohcStore",\n        # "lohcDistribute",\n        # "nh3Produce",\n        # "nh3Store",\n        # "nh3Distribute",\n        # "fertProduce",\n        # "fertStore",\n        # "fertDistribute",\n        # "mp1Produce",\n        # "mp1Store",\n        # "mp1Distribute",\n    #    "ironPrePProduce",\n    #    "ironRawProduce",\n    #    "ironPostPProduce",\n    #    "ironStore",\n    #    "ironDistribute",\n        "port",\n        "road",\n        "electricityBtmTransmission",\n        "electricityGridTransmission",\n        "electricityGrid",\n    ]\n\n\n    for i in range(0, len(facilities) - 4):\n        capex[facilities[i]] = (\n            settings.get(facilities[i] + "Capacity", 0) * settings.get(facilities[i] + "UnitCapex",0) * settings["capexCostsFactor"]\n        )\n    capex["port"] = settings["portCapex"] * settings["capexCostsFactor"]\n    capex["electricityBtmTransmission"] = (\n        settings["electricityBtmTransmissionDistance"]\n        * settings["electricityBtmTransmissionUnitCapex"]\n        * settings["electricityBtmTransmissionCapacity"]\n        * settings["capexCostsFactor"]\n        / 1000\n    )\n    capex["electricityGridTransmission"] = (\n        settings["electricityGridTransmissionDistance"]\n        * settings["electricityGridTransmissionUnitCapex"]\n        * settings["electricityGridTransmissionCapacity"]\n        * settings["capexCostsFactor"]\n        / 1000\n    )\n    capex["road"] = settings["roadDistance"] * settings["roadUnitCapex"] * settings["capexCostsFactor"]\n    capex["electricityGrid"] = 0\n    capex["electricityDistribute"] = s["electricityDistributeCapacity"] * settings["electricityDistributeUnitCapex"] * settings["capexCostsFactor"]\n    capex["electricity"] = (\n        capex["electricitySolarPv"]\n        + capex["electricityWindTurbines"]\n        + capex["electricityGasTurbines"]\n        + capex["electricityStore"]\n        + capex["electricityDistribute"]\n        + capex["electricityBtmTransmission"]\n        + capex["electricityGridTransmission"]\n        + capex["electricityGrid"]\n    )\n    capex["waterDistribute"] = s["waterDistributeCapacity"] * settings["waterDistributeUnitCapex"]* settings["capexCostsFactor"]\n    capex["waterProduce"] = s["waterProduceCapacity"] * settings["waterProduceUnitCapex"]* settings["capexCostsFactor"]\n    capex["waterStore"] = s["waterStoreCapacity"] * settings["waterStoreUnitCapex"]* settings["capexCostsFactor"]\n    capex["water"] = capex["waterProduce"] + capex["waterStore"] + capex["waterDistribute"]\n    capex["h2Distribute"] = s["h2DistributeCapacity"] * settings["h2DistributeUnitCapex"]* settings["capexCostsFactor"]\n    capex["h2"] = capex["h2Produce"] + capex["h2Store"] + capex["h2Distribute"]\n\n    capex["ironPrePProduce"] = s["ironPrePProduceCapacity"] * settings["ironPrePProduceUnitCapex"]* settings["capexCostsFactor"]\n    capex["ironRawProduce"] = s["ironRawProduceCapacity"] * settings["ironRawProduceUnitCapex"] * settings["capexCostsFactor"]\n    capex["ironPostPProduce"] = s["ironPostPProduceCapacity"] * settings["ironPostPProduceUnitCapex"]* settings["capexCostsFactor"]\n    capex["ironDistribute"] = s["ironDistributeCapacity"] * settings["ironDistributeUnitCapex"]* settings["capexCostsFactor"]\n\n\n    capex["iron"] = capex["ironPrePProduce"] + capex["ironRawProduce"] + capex["ironPostPProduce"] + capex["ironDistribute"]\n    capex["transport"] = capex["port"] + capex["road"]\n    capex["total"] = (\n        capex["electricity"]\n        + capex["water"]\n        + capex["h2"]\n     #   + capex["lohc"]\n     #   + capex["nh3"]\n     #   + capex["fert"]\n     #   + capex["mp1"]\n        + capex["iron"]\n        + capex["transport"]\n    )\n\n    capexKeys = facilities\n    capexKeys.insert(0,"electricityDistribute")\n    capexKeys.insert(0,"waterDistribute")\n    capexKeys.insert(0,"h2Distribute")\n    capexKeys.insert(0,"waterProduce")\n    capexKeys.insert(0,"waterStore")\n    capexKeys.insert(0,"ironPrePProduce")\n    capexKeys.insert(0,"ironRawProduce")\n    capexKeys.insert(0,"ironPostPProduce")\n    capexKeys.insert(0,"ironDistribute")\n\n    finex = {}\n    for i in range(0, len(capexKeys) - 1):\n        finex[capexKeys[i]] = -1 * financial_pmt(\n            settings["wacc"],\n            settings[capexKeys[i] + "Life"],\n            capex[capexKeys[i]],\n        )\n    \n    #Overwrite with renewables specific WACC rate\n\n    renewableFacilities = [\n        "electricitySolarPv",\n        "electricityWindTurbines",\n        "electricityStore",\n        "electricityDistribute",\n        "electricityBtmTransmission",\n        "electricityGridTransmission",\n        "electricityGrid",\n    ]\n    for i in range(0, len(renewableFacilities) - 1):\n        finex[renewableFacilities[i]] = -1 * financial_pmt(\n            settings["waccRenewables"],\n            settings[renewableFacilities[i] + "Life"],\n            capex[renewableFacilities[i]],\n        )\n    \n    finex["electricityGrid"] = 0\n    finex["electricity"] = (\n        finex["electricitySolarPv"]\n        + finex["electricityWindTurbines"]\n        + finex["electricityGasTurbines"]\n        + finex["electricityStore"]\n        + finex["electricityDistribute"]\n        + finex["electricityBtmTransmission"]\n        + finex["electricityGridTransmission"]\n        + finex["electricityGrid"]\n    )\n    finex["water"] = (\n        finex["waterProduce"] + finex["waterStore"] + finex["waterDistribute"]\n    )\n    finex["h2"] = finex["h2Produce"] + finex["h2Store"] + finex["h2Distribute"]\n    #finex["lohc"] = finex["lohcProduce"] + finex["lohcStore"] + finex["lohcDistribute"]\n    #finex["nh3"] = finex["nh3Produce"] + finex["nh3Store"] + finex["nh3Distribute"]\n    #finex["fert"] = finex["fertProduce"] + finex["fertStore"] + finex["fertDistribute"]\n    #finex["mp1"] = finex["mp1Produce"] + finex["mp1Store"] + finex["mp1Distribute"]\n    finex["iron"] = finex["ironPrePProduce"] + finex["ironRawProduce"] + finex["ironPostPProduce"]  + finex["ironDistribute"]\n    finex["transport"] = finex["port"] + finex["road"]\n    finex["total"] = (\n        finex["electricity"]\n        + finex["water"]\n        + finex["h2"]\n    #    + finex["lohc"]\n    #    + finex["nh3"]\n    #    + finex["fert"]\n    #    + finex["mp1"]\n        + finex["iron"]\n        + finex["transport"]\n    )\n\n    opex = {}\n    for i in range(0, len(capexKeys)):\n        opex[capexKeys[i]] = capex[capexKeys[i]] * settings["opexFactor"]\n    opex["electricity"] = (\n        opex["electricitySolarPv"]\n        + opex["electricityWindTurbines"]\n        + opex["electricityGasTurbines"]\n        + opex["electricityStore"]\n        + opex["electricityDistribute"]\n        + opex["electricityBtmTransmission"]\n        + opex["electricityGridTransmission"]\n        + opex["electricityGrid"]\n    )\n    opex["water"] = opex["waterProduce"] + opex["waterStore"] + opex["waterDistribute"]\n    opex["h2"] = opex["h2Produce"] + opex["h2Store"] + opex["h2Distribute"]\n    #opex["lohc"] = opex["lohcProduce"] + opex["lohcStore"] + opex["lohcDistribute"]\n    #opex["nh3"] = opex["nh3Produce"] + opex["nh3Store"] + opex["nh3Distribute"]\n    #opex["fert"] = opex["fertProduce"] + opex["fertStore"] + opex["fertDistribute"]\n    #opex["mp1"] = opex["mp1Produce"] + opex["mp1Store"] + opex["mp1Distribute"]\n    opex["iron"] = opex["ironPrePProduce"] + opex["ironRawProduce"] + opex["ironPostPProduce"]  + opex["ironDistribute"]\n    opex["transport"] = opex["port"] + opex["road"]\n    opex["total"] = (\n        opex["electricity"]\n        + opex["water"]\n        + opex["h2"]\n    #    + opex["lohc"]\n    #    + opex["nh3"]\n    #    + opex["fert"]\n    #    + opex["mp1"]\n        + opex["iron"]\n        + opex["transport"]\n    )\n\n    resourcex = {}\n    for i in range(0, len(capexKeys)):\n        resourcex[capexKeys[i]] = 0\n\n    resourcex["electricityGasTurbines"] = (\n        settings["naturalGasUnitCost"]\n        * (annualResults["electricityProduceGasTurbinesNaturalGas"] / 1000000)\n    )\n    # (annualResults["mp1ProduceOutput"]) / settings["mp1OreToMp1"]\n#    resourcex["mp1Produce"] = (\n#        settings["mp1OreUnitCost"]\n#       * (annualResults["mp1ProduceOutput"])\n#        * settings["mp1OreToMp1"]\n#        + settings["mp1ReagentsUnitCost"]\n#        * (annualResults["mp1ProduceOutput"])\n#        * settings["mp1ReagentsToMp1"]\n#    ) / 1000000\n    resourcex["ironPrePProduce"] = (\n        settings["ironOreUnitCost"]\n        * annualResults["ironPrePProduceOutput"]\n        * settings["ironOreToIronPreP"]\n        + settings["naturalGasUnitCost"]\n        * annualResults["ironPrePNaturalGas"]\n    ) / 1000000\n\n    resourcex["ironRawProduce"] = (\n        settings["naturalGasUnitCost"]\n        * annualResults["ironRawNaturalGas"]\n    ) / 1000000\n\n    resourcex["ironPostPProduce"] = (\n        settings["naturalGasUnitCost"]\n        * annualResults["ironPostPNaturalGas"]\n    ) / 1000000\n\n    resourcex["electricityGrid"] = (\n        annualResults["electricityGridCost"]\n        / 1000000\n    )\n\n    resourcex["electricity"] = (\n        resourcex["electricitySolarPv"]\n        + resourcex["electricityWindTurbines"]\n        + resourcex["electricityGasTurbines"]\n        + resourcex["electricityStore"]\n        + resourcex["electricityDistribute"]\n        + resourcex["electricityBtmTransmission"]\n        + resourcex["electricityGridTransmission"]\n        + resourcex["electricityGrid"]\n    )\n    resourcex["water"] = (\n        resourcex["waterProduce"]\n        + resourcex["waterStore"]\n        + resourcex["waterDistribute"]\n    )\n    resourcex["h2"] = (\n        resourcex["h2Produce"] + resourcex["h2Store"] + resourcex["h2Distribute"]\n    )\n    #resourcex["lohc"] = (\n    #    resourcex["lohcProduce"] + resourcex["lohcStore"] + resourcex["lohcDistribute"]\n    #)\n    # resourcex["nh3"] = (\n    #     resourcex["nh3Produce"] + resourcex["nh3Store"] + resourcex["nh3Distribute"]\n    # )\n    # resourcex["fert"] = (\n    #     resourcex["fertProduce"] + resourcex["fertStore"] + resourcex["fertDistribute"]\n    # )\n    # resourcex["mp1"] = (\n    #     resourcex["mp1Produce"] + resourcex["mp1Store"] + resourcex["mp1Distribute"]\n    # )\n    resourcex["iron"] = (\n        resourcex["ironPrePProduce"] + resourcex["ironRawProduce"] + resourcex["ironPostPProduce"]  + resourcex["ironDistribute"]\n    )\n    resourcex["transport"] = resourcex["port"] + resourcex["road"]\n    resourcex["total"] = (\n        resourcex["electricity"]\n        + resourcex["water"]\n        + resourcex["h2"]\n    #    + resourcex["lohc"]\n    #    + resourcex["nh3"]\n    #    + resourcex["fert"]\n    #    + resourcex["mp1"]\n        + resourcex["iron"]\n        + resourcex["transport"]\n    )\n\n    carbonex = {}\n    for i in range(0, len(capexKeys)):\n        carbonex[capexKeys[i]] = 0\n\n    carbonex["electricityGrid"] = (settings["carbonPrice"] * annualResults["electricityProduceGridEmissions"])/1000000\n\n    carbonex["electricityGasTurbines"] = (settings["carbonPrice"] * annualResults["electricityProduceGasTurbinesEmissions"])/1000000\n\n    carbonex["electricity"] = carbonex["electricityGrid"] + carbonex["electricityGasTurbines"]\n\n    carbonex["water"] = carbonex["waterProduce"] + carbonex["waterStore"] + carbonex["waterDistribute"]\n\n    carbonex["h2"] = carbonex["h2Produce"] + carbonex["h2Store"] + carbonex["h2Distribute"]\n\n    carbonex["ironPrePProduce"] = (settings["carbonPrice"] * annualResults["ironPrePEmissions"])/1000000\n\n    carbonex["ironRawProduce"] = (settings["carbonPrice"] * annualResults["ironRawEmissions"])/1000000\n\n    carbonex["ironPostPProduce"] = (settings["carbonPrice"] * annualResults["ironPostPEmissions"])/1000000\n    \n    carbonex["iron"] = carbonex["ironPrePProduce"] + carbonex["ironRawProduce"] + carbonex["ironPostPProduce"]\n\n\n    carbonex["total"] = carbonex["electricity"] + carbonex["iron"]\n\n    annualCost = {}\n    for i in range(0, len(capexKeys)):\n        annualCost[capexKeys[i]] = (\n            finex[capexKeys[i]] + opex[capexKeys[i]] + resourcex[capexKeys[i]] + carbonex[capexKeys[i]]\n        )\n\n    annualCost["electricity"] = (\n        annualCost["electricitySolarPv"]\n        + annualCost["electricityWindTurbines"]\n        + annualCost["electricityGasTurbines"]\n        + annualCost["electricityStore"]\n        + annualCost["electricityDistribute"]\n        + annualCost["electricityBtmTransmission"]\n        + annualCost["electricityGridTransmission"]\n        + annualCost["electricityGrid"]\n    )\n    annualCost["water"] = (\n        annualCost["waterProduce"]\n        + annualCost["waterStore"]\n        + annualCost["waterDistribute"]\n    )\n    annualCost["h2"] = (\n        annualCost["h2Produce"] + annualCost["h2Store"] + annualCost["h2Distribute"]\n    )\n    # annualCost["lohc"] = (\n    #     annualCost["lohcProduce"]\n    #     + annualCost["lohcStore"]\n    #     + annualCost["lohcDistribute"]\n    # )\n    # annualCost["nh3"] = (\n    #     annualCost["nh3Produce"] + annualCost["nh3Store"] + annualCost["nh3Distribute"]\n    # )\n    # annualCost["fert"] = (\n    #     annualCost["fertProduce"]\n    #     + annualCost["fertStore"]\n    #     + annualCost["fertDistribute"]\n    # )\n    # annualCost["mp1"] = (\n    #     annualCost["mp1Produce"] + annualCost["mp1Store"] + annualCost["mp1Distribute"]\n    # )\n    annualCost["iron"] = (\n        annualCost["ironPrePProduce"] + annualCost["ironRawProduce"] + annualCost["ironPostPProduce"]  + annualCost["ironDistribute"]\n    )\n    annualCost["transport"] = annualCost["port"] + annualCost["road"]\n    annualCost["total"] = (\n        annualCost["electricity"]\n        + annualCost["water"]\n        + annualCost["h2"]\n#        + annualCost["lohc"]\n#        + annualCost["nh3"]\n#        + annualCost["fert"]\n#        + annualCost["mp1"]\n        + annualCost["iron"]\n        + annualCost["transport"]\n    )\n\n    annualRevenue = {}\n    h2_tax_credit = settings.get("h2TaxCredit", 0)\n    annualRevenue["electricity"] = annualResults["electricityGridRevenue"] / 1000000\n    \n#   annualRevenue["lohc"] = (\n#        annualResults["lohcDistributeOutput"] * settings["lohcMarketValue"] / 1000\n#        + (annualResults["lohcH2Used"] * h2_tax_credit) / 1000\n#    )\n#    annualRevenue["mp1"] = (\n#       annualResults["mp1DistributeOutput"] * settings["mp1MarketValue"] / 1000\n#    )\n    annualRevenue["iron"] = (\n        annualResults["ironDistributeOutput"] * (settings["ironMarketValue"] + settings["ironMarketEmissionsIntensity"]*settings["carbonPrice"]/1000)/ 1000\n        + (annualResults["ironH2Used"] * h2_tax_credit) / 1000\n#    )\n#    annualRevenue["fert"] = (\n#        annualResults["fertDistributeOutput"] * settings["fertMarketValue"] / 1000\n#        + ((annualResults["nh3H2Used"] * h2_tax_credit) / 1000)\n#       * annualResults["fertNh3Used"]\n#        / annualResults["nh3DistributeOutput"]\n    )\n#    annualRevenue["nh3Export"] = (\n#        annualResults["nh3DistributeOutput"] - annualResults["fertNh3Used"]\n#    ) * (settings["nh3MarketValue"] / 1000) + (\n#        (annualResults["nh3H2Used"] * h2_tax_credit) / 1000\n#    ) * (\n#        annualResults["nh3DistributeOutput"] - annualResults["fertNh3Used"]\n#    ) / annualResults["nh3DistributeOutput"]\n    annualRevenue["total"] = (\n        annualRevenue["electricity"]\n #       + annualRevenue["lohc"]\n#        + annualRevenue["mp1"]\n        + annualRevenue["iron"]\n #       + annualRevenue["fert"]\n #       + annualRevenue["nh3Export"]\n    )\n\n    annualMargin = annualRevenue["total"] - annualCost["total"]\n    annualCash = list(range(round(settings["npvPeriod"])))\n    for i in range(round(settings["npvPeriod"])):\n        annualCash[i] = annualMargin\n\n    npv = financial_npv(settings["discountRate"], annualCash)\n\n    \n    capex = reorder_dict_alphabetically(capex)\n    finex = reorder_dict_alphabetically(finex)\n    opex = reorder_dict_alphabetically(opex)\n    resourcex = reorder_dict_alphabetically(resourcex)\n    carbonex = reorder_dict_alphabetically(carbonex)\n    annualCost = reorder_dict_alphabetically(annualCost)\n    annualRevenue = reorder_dict_alphabetically(annualRevenue)  \n\n    metrics = {}\n\n    metrics["ironUtilisation"] = annualResults["ironProduceOutput"] / (settings["ironProduceCapacity"]*settings["simLength"])\n    metrics["h2Utilisation"] = annualResults["h2ProduceOutput"] / (settings["h2ProduceCapacity"]*settings["simLength"])\n    metrics["emissionsIntensity"] = annualResults["emissionsTotal"] / annualResults["ironProduceOutput"]\n    metrics["npv"] = npv\n    metrics["annualMargin"] = annualRevenue["total"] - annualCost["total"]\n    metrics["capexTotal"] = capex["total"]\n    metrics["capexElectricity"] = capex["electricity"]\n    metrics["capexWater"] = capex["water"]\n    metrics["capexH2"] = capex["h2"]\n    metrics["capexIron"] = capex["iron"]\n    metrics["annualCostsTotal"] = annualCost["total"]\n    metrics["lcoi"] = 1000000 * annualCost["total"] / annualResults["ironProduceOutput"]\n    metrics["lcoe"] = 1000000 * annualCost["electricity"] / annualResults["electricityProduceOutput"]\n    h2TotalCost = annualCost["h2"] + annualCost["electricity"]*(annualResults["h2ElectricityUsed"]/annualResults["electricityDistributeOutput"]) + annualCost["water"]*(annualResults["h2WaterUsed"]/annualResults["waterDistributeOutput"])\n    metrics["lcoh"] = 1000 * h2TotalCost / annualResults["h2ProduceOutput"]\n\n    metrics["lcoi-ex"] = 1000000 * (annualCost["total"] - annualRevenue["electricity"]) / annualResults["ironProduceOutput"]\n    metrics["lcoe-ex"] = 1000000 * (annualCost["electricity"] - annualRevenue["electricity"]) / annualResults["electricityProduceOutput"]\n    metrics["lcoh-ex"] = 1000000 * (h2TotalCost - annualRevenue["electricity"]) / (1000 * annualResults["h2ProduceOutput"])\n\n    return capex, finex, opex, resourcex, carbonex, annualCost, annualRevenue, metrics\n');__stickytape_write_module('results/financial.py',b'def financial_npv(rate, values):\n    return sum(val / (1 + rate) ** i for i, val in enumerate(values))\n\n\ndef financial_pmt(rate, nper, pv, fv=0, when="end"):\n    when_mult = 1 if when == "begin" else 0\n    is_rate_zero = rate == 0\n    temp = (1 + rate) ** nper\n    masked_rate = 1 if is_rate_zero else rate\n    fact = (\n        nper\n        if is_rate_zero\n        else ((1 + masked_rate * when_mult) * (temp - 1) / masked_rate)\n    )\n    return -(fv + pv * temp) / fact\n');__stickytape_write_module('model/stateAndUnits.py',b"def populateStateAndUnitObjects(state):\n\n    units = {}\n\n    mwhVariables = ['electricityRawSolarPvOutput',\n                    'electricityRawWindTurbinesOutput',\n                    'electricityRawRenewableOutput',\n                    'h2ElectricityDemand',\n                    'waterElectricityDemand',\n                    'electricityDistributeDemand',\n                    'electricityDistributeRenewableOutput',\n                    'electricityProduceRenewableOutput',\n                    'electricityProduceFirmingDemand',\n                    'electricityProduceFirmingFull',\n                    'electricityProduceFirmingMinimum',\n                    'electricityProduceFirmingOutput',\n                    'electricityProduceGridDemand',\n                    'electricityProduceGasTurbinesDemand',\n                    'electricityProduceSolarPvOutput',\n                    'electricityProduceWindTurbinesOutput',\n                    'electricityProduceGridOutput',\n                    'electricityProduceGasTurbinesOutput',\n                    'electricityProduceOutput',\n                    'electricityStoreLevel', \n                    'electricityStoreChange',\n                    'electricityStoreCharge',\n                    'electricityStoreDischarge',\n                    'electricityDistributeOutput', \n                    'electricityStoreLevelNew', \n                    'waterElectricitySupply', \n                    'h2ElectricitySupply', \n                    'electricityDemand', \n                    'h2ElectricityUsed', \n                    'waterElectricityUsed', \n                    'electricityUsed', \n                    'lohcElectricityUsed',\n                    'ironElectricityDemand', \n                    'ironElectricitySupply', \n                    'ironElectricityUsed',\n                    'ironPrePElectricityDemand',\n                    'ironPrePElectricitySupply',\n                    'ironPrePElectricityUsed',\n                    'ironRawElectricityDemand', \n                    'ironRawElectricitySupply', \n                    'ironRawElectricityUsed',\n                    'ironPostPElectricityDemand', \n                    'ironPostPElectricitySupply', \n                    'ironPostPElectricityUsed',\n                    'electricityGridExportDemand',\n                    'electricityGridExportUsed',\n                    'electricityNet']\n    tVariables = ['h2DistributeDemand',\n                  'h2StoreDemand',\n                  'h2ProduceDemand',\n                  'h2WaterDemand', \n                  'waterDistributeDemand', \n                  'waterStoreDemand', \n                  'waterProduceDemand', 'waterProduceOutput', 'waterStoreLevel', 'waterStoreChange', 'waterDistributeOutput', 'waterStoreLevelNew', 'h2WaterSupply', 'h2ProduceOutput', 'h2StoreLevel', 'h2StoreChange', 'h2DistributeOutput', 'h2StoreLevelNew', 'h2CumulativeOutput', 'h2CumulativeOutputNew', 'h2CumulativeOutputTarget','waterDemand', 'h2Demand', 'waterCumulativeOutput', 'h2WaterUsed', 'waterUsed', 'h2Used', 'ironFinalDemand', 'ironProduceDemand','ironPrePProduceDemand','ironRawProduceDemand','ironPostPProduceDemand', 'ironH2Demand','ironH2Supply','ironH2Used','ironWaterDemand','ironWaterSupply','ironWaterUsed','ironProduceOutput','ironPrePH2Supply','ironPrePH2Used','ironPrePWaterDemand','ironPrePWaterSupply','ironPrePWaterUsed','ironPrePProduceOutput','ironRawH2Demand','ironRawH2Supply','ironRawH2Used','ironRawWaterDemand','ironRawWaterSupply','ironRawWaterUsed','ironRawProduceOutput','ironRawWaterOutput','ironPostPH2Demand','ironPostPH2Supply','ironPostPH2Used','ironPostPWaterDemand','ironPostPWaterSupply','ironPostPWaterUsed','ironPostPProduceOutput', 'ironDistributeOutput', 'ironCumulativeOutput', 'ironCumulativeOutputNew','ironCumulativeOutputTarget','h2Net','ironDistributeDemand','ironPrePH2Demand','waterNet']\n    naVariables = ['firmingAllowed','electricityGridExport']\n    gjVariables = ['electricityNaturalGasUsed',\n                   'electricityProduceGasTurbinesNaturalGas',\n                   'electricityProduceGasTurbinesNaturalGas',\n                   'ironPostPNaturalGas',\n                   'ironRawHeatingNaturalGas',\n                   'ironRawReducingNaturalGas',\n                   'ironRawNaturalGas',\n                   'ironPrePNaturalGas',\n                   'ironNaturalGas',\n                   'naturalGasTotal']\n    tco2eVariables = ['electricityProduceGridEmissions',\n                      'electricityProduceFirmingEmissions',\n                      'electricityProduceGasTurbinesEmissions', \n                      'electricityDistributeEmissions',\n                      'ironRawEmissions', \n                      'cumulativeEmissions', \n                      'waterEmissions', \n                      'waterCumulativeEmissions', \n                      'h2Emissions', \n                      'h2CumulativeEmissions',\n                      'ironPrePEmissions',\n                      'ironRawEmissions',\n                      'ironPostPEmissions',\n                      'ironEmissions',\n                      'ironUpstreamEmissions', \n                      'ironCumulativeEmissions',\n                      'cumulativeEmissionsAllowed',\n                      'emissionsTotal']\n    kgco2ekgVariables = ['h2EmissionsIntensityYtd', \n                        'ironEmissionsIntensityYtd']\n    tco2emwhVariables = ['electricityDistributeEmissionsIntensity']\n    audVariables = ['electricityGridCost',\n                    'electricityGridRevenue',\n                    'electricityGridNetworkCharge',\n                    'electricityGridKvaCharge',\n                    'electricityGridWholesaleCost']\n\n    for name in mwhVariables:\n        units[name] = 'MWh'\n    for name in tVariables:\n        units[name] = 't'\n    for name in naVariables:\n        units[name] = 'NA'\n    for name in gjVariables:\n        units[name] = 'GJ'\n    for name in tco2eVariables:\n        units[name] = 'tCO2e'\n    for name in kgco2ekgVariables:\n        units[name] = 'kgCO2e/kg'\n    for name in tco2emwhVariables:\n        units[name] = 'tCO2e/MWh'\n    for name in audVariables:\n        units[name] = 'A$'\n\n    namedDictionaries = ['ironRawWaterOutputDict',\n                         'emissionsTotalDict',\n                         'ironPostPNaturalGasDict',\n                         'ironRawHeatingNaturalGasDict',\n                         'ironRawReducingNaturalGasDict',\n                         'ironRawNaturalGasDict',\n                         'ironPrePNaturalGasDict',\n                         'ironNaturalGasDict',\n                         'naturalGasTotalDict',\n                         'ironUpstreamEmissionsDict',\n                         'ironRawEmissionsDict',\n                         'ironPrePEmissionsDict',\n                         'ironPostPEmissionsDict',\n                         'ironEmissionsDict',\n                         'electricityStoreChargeDict',\n                         'electricityStoreDischargeDict',\n                         'electricityDistributeDemandDict', 'electricityDistributeOutputDict', 'electricityDistributeRenewableOutputDict', 'electricityProduceGridEmissionsDict', 'electricityProduceGridOutputDict','electricityProduceFirmingEmissionsDict', 'electricityProduceFirmingOutputDict', 'electricityProduceFirmingDemandDict', 'electricityProduceFirmingFullDict', 'electricityProduceFirmingMinimumDict', 'firmingAllowedDict','electricityGridDict','electricityProduceGasTurbinesEmissionsDict','electricityProduceGasTurbinesNaturalGasDict', 'electricityProduceGasTurbinesOutputDict', 'electricityProduceOutputDict', 'electricityProduceRenewableOutputDict', 'electricityProduceSolarPvOutputDict', 'electricityProduceWindTurbinesOutputDict', 'electricityRawRenewableOutputDict', 'electricityRawSolarPvOutputDict', 'electricityRawWindTurbinesOutputDict', 'electricityUsedDict', 'h2DistributeDemandDict', 'h2DistributeOutputDict', 'h2ElectricityDemandDict', 'h2ElectricityUsed0Dict', 'h2ElectricityUsedDict', 'h2ProduceOutputDict', 'h2UsedDict', 'h2WaterDemandDict', 'h2WaterUsed0Dict', 'h2WaterUsedDict', 'ironDistributeDemandDict', 'ironDistributeOutputDict', 'ironElectricityDemandDict', 'ironElectricityUsed0Dict', 'ironElectricityUsedDict','ironH2DemandDict', 'ironH2Used0Dict', 'ironH2UsedDict', 'ironEmissionsIntensityYtdDict','ironProduceOutputDict','ironPrePElectricityDemandDict', 'ironPrePElectricityUsed0Dict', 'ironPrePElectricityUsedDict','ironPrePH2DemandDict', 'ironPrePH2Used0Dict', 'ironPrePH2UsedDict', 'ironRawElectricityDemandDict','ironRawElectricityUsed0Dict', 'ironRawElectricityUsedDict','ironRawH2DemandDict', 'ironRawH2Used0Dict', 'ironRawH2UsedDict','ironPostPElectricityDemandDict','ironPostPElectricityUsed0Dict', 'ironPostPElectricityUsedDict','ironPostPH2DemandDict', 'ironPostPH2Used0Dict', 'ironPostPH2UsedDict','ironPrePProduceOutputDict','ironRawProduceOutputDict','ironPostPProduceOutputDict', 'lohcProduceOutputDict','waterDistributeDemandDict', 'waterDistributeOutputDict', 'waterElectricityDemandDict', 'waterElectricityUsed0Dict', 'waterElectricityUsedDict', 'waterProduceOutput0Dict', 'waterProduceOutputDict','waterUsedDict', 'electricityStoreLevelDict', 'waterStoreLevelDict', 'h2StoreLevelDict','ironWaterUsedDict','ironPrePWaterUsedDict','ironRawWaterUsedDict','ironPostPWaterUsedDict','cumulativeEmissionsAllowedDict','electricityGridCostDict','electricityGridRevenueDict','electricityGridExportDemandDict','electricityGridExportUsedDict','electricityNetDict','waterNetDict','h2NetDict','electricityGridNetworkChargeDict','electricityGridKvaChargeDict','electricityGridWholesaleCostDict']\n    allDictVariables = []\n    allDictVariables.extend(mwhVariables)\n    allDictVariables.extend(tVariables)\n    allDictVariables.extend(naVariables)\n    allDictVariables.extend(tco2eVariables)\n    allDictVariables.extend(gjVariables)\n    allDictVariables.extend(kgco2ekgVariables)\n    allDictVariables.extend(tco2emwhVariables)\n    allDictVariables.extend(namedDictionaries)\n    allDictVariables.extend(audVariables)\n    for name in allDictVariables:\n        state[name] = {}\n\t\n    return state, units\n\n");__stickytape_write_module('sys_logging.py',b'from helpers.singleton import SingletonMeta\nfrom helpers.general import isSystemiser\n\nclass Logging(metaclass=SingletonMeta):\n    def __init__(self):\n        self.logs = []\n        self.enabled = False\n\n    def reset(self):\n        self.logs = []\n\n    def setEnabled(self, on: bool):\n        self.enabled = on\n\n    def add(\n        self,\n        message: str,\n    ):\n        if not self.enabled:\n            return\n        if not isSystemiser():\n            print(message)\n        self.logs.append(message)\n\n    def read(self):\n        return self.logs\n\nlogs = Logging()\n\ndef setLoggingEnabled(enabled):\n    logs.setEnabled(enabled)\n\ndef log(message):\n    logs.add(message)\n\ndef getLog():\n    return logs.read()\n\ndef resetLogs():\n    logs.setEnabled(False)\n    logs.reset()\n');__stickytape_write_module('helpers/singleton.py',b'class SingletonMeta(type):\n    """\n    The Singleton class can be implemented in different ways in Python. Some\n    possible methods include: base class, decorator, metaclass. We will use the\n    metaclass because it is best suited for this purpose.\n    """\n\n    _instances = {}\n\n    def __call__(cls, *args, **kwargs):\n        """\n        Possible changes to the value of the `__init__` argument do not affect\n        the returned instance.\n        """\n        if cls not in cls._instances:\n            instance = super().__call__(*args, **kwargs)\n            cls._instances[cls] = instance\n        return cls._instances[cls]\n');from model.simulation import simulation;from model.stateAndUnits import populateStateAndUnitObjects;from sys_logging import setLoggingEnabled;from helpers.status import systemiserStatusMessage
	def set__sysUpdateStatus(in_put):global __sysUpdateStatus;__sysUpdateStatus=in_put
	def systemiserRun(state,settings,units):B=units;A=state;A,B=populateStateAndUnitObjects(A);systemiserStatusMessage('Running');setLoggingEnabled(True);return simulation(A,settings,B)